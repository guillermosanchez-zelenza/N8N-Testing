import{m as _}from"./pinia-aUqqC48i.js";import{e as O,f as R,u as E,l as I,t as b,h as c,bm as h,V as B,bn as P,_ as A}from"./n8n-_nNvRoCf.js";import{j as D,ax as V,d as N}from"./index-xP-VuMjv.js";import{G as Q,ag as t,l as n,m as l,p,T as i,O as o,S as v,R as S,I as g,Q as u,M as m,F,a7 as z}from"./vendor-NNwioulI.js";import"./lodash-es-5z_C16pm.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./esprima-next-ulPLCZ1Z.js";import"./luxon-ZRIU05qF.js";import"./@vueuse/core-8g26_cc0.js";import"./uuid-McvpxQtQ.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";const K=Q({name:"SettingsUsersView",setup(){return{clipboard:D(),...O()}},async mounted(){this.showUMSetupWarning||await this.usersStore.fetchUsers()},computed:{..._(I,E,R,N,V),isSharingEnabled(){return this.settingsStore.isEnterpriseFeatureEnabled(b.Sharing)},showUMSetupWarning(){return c(["defaultUser"])},usersListActions(){return[{label:this.$locale.baseText("settings.users.actions.copyInviteLink"),value:"copyInviteLink",guard:e=>this.settingsStore.isBelowUserQuota&&!e.firstName&&!!e.inviteAcceptUrl},{label:this.$locale.baseText("settings.users.actions.reinvite"),value:"reinvite",guard:e=>this.settingsStore.isBelowUserQuota&&!e.firstName&&this.settingsStore.isSmtpSetup},{label:this.$locale.baseText("settings.users.actions.delete"),value:"delete",guard:e=>c(["rbac"],{rbac:{scope:"user:delete"}})&&e.id!==this.usersStore.currentUserId},{label:this.$locale.baseText("settings.users.actions.copyPasswordResetLink"),value:"copyPasswordResetLink",guard:e=>c(["rbac"],{rbac:{scope:"user:resetPassword"}})&&this.settingsStore.isBelowUserQuota&&!e.isPendingUser&&e.id!==this.usersStore.currentUserId},{label:this.$locale.baseText("settings.users.actions.allowSSOManualLogin"),value:"allowSSOManualLogin",guard:e=>{var s;return this.settingsStore.isSamlLoginEnabled&&!((s=e.settings)!=null&&s.allowSSOManualLogin)}},{label:this.$locale.baseText("settings.users.actions.disallowSSOManualLogin"),value:"disallowSSOManualLogin",guard:e=>{var s;return this.settingsStore.isSamlLoginEnabled&&((s=e.settings)==null?void 0:s.allowSSOManualLogin)===!0}}]},isAdvancedPermissionsEnabled(){return this.settingsStore.isEnterpriseFeatureEnabled(b.AdvancedPermissions)},userRoles(){return[{value:h.Member,label:this.$locale.baseText("auth.roles.member")},{value:h.Admin,label:this.$locale.baseText("auth.roles.admin"),disabled:!this.isAdvancedPermissionsEnabled}]},canUpdateRole(){return c(["rbac"],{rbac:{scope:["user:update","user:changeRole"]}})}},methods:{redirectToSetup(){this.$router.push({name:B.SETUP})},onInvite(){this.uiStore.openModal(P)},async onDelete(e){this.usersStore.getUserById(e)&&this.uiStore.openDeleteUserModal(e)},async onReinvite(e){const s=this.usersStore.getUserById(e);if(s!=null&&s.email&&(s!=null&&s.role)){if(!["global:admin","global:member"].includes(s.role))throw new Error("Invalid role name on reinvite");try{await this.usersStore.reinviteUser({email:s.email,role:s.role}),this.showToast({type:"success",title:this.$locale.baseText("settings.users.inviteResent"),message:this.$locale.baseText("settings.users.emailSentTo",{interpolate:{email:s.email??""}})})}catch(d){this.showError(d,this.$locale.baseText("settings.users.userReinviteError"))}}},async onCopyInviteLink(e){const s=this.usersStore.getUserById(e);s!=null&&s.inviteAcceptUrl&&(this.clipboard.copy(s.inviteAcceptUrl),this.showToast({type:"success",title:this.$locale.baseText("settings.users.inviteUrlCreated"),message:this.$locale.baseText("settings.users.inviteUrlCreated.message")}))},async onCopyPasswordResetLink(e){const s=this.usersStore.getUserById(e);if(s){const d=await this.usersStore.getUserPasswordResetLink(s);this.clipboard.copy(d.link),this.showToast({type:"success",title:this.$locale.baseText("settings.users.passwordResetUrlCreated"),message:this.$locale.baseText("settings.users.passwordResetUrlCreated.message")})}},async onAllowSSOManualLogin(e){const s=this.usersStore.getUserById(e);s&&(s.settings||(s.settings={}),s.settings.allowSSOManualLogin=!0,await this.usersStore.updateOtherUserSettings(e,s.settings),this.showToast({type:"success",title:this.$locale.baseText("settings.users.allowSSOManualLogin"),message:this.$locale.baseText("settings.users.allowSSOManualLogin.message")}))},async onDisallowSSOManualLogin(e){const s=this.usersStore.getUserById(e);s!=null&&s.settings&&(s.settings.allowSSOManualLogin=!1,await this.usersStore.updateOtherUserSettings(e,s.settings),this.showToast({type:"success",title:this.$locale.baseText("settings.users.disallowSSOManualLogin"),message:this.$locale.baseText("settings.users.disallowSSOManualLogin.message")}))},goToUpgrade(){this.uiStore.goToUpgrade("settings-users","upgrade-users")},goToUpgradeAdvancedPermissions(){this.uiStore.goToUpgrade("settings-users","upgrade-advanced-permissions")},async onRoleChange(e,s){await this.usersStore.updateGlobalRole({id:e.id,newRoleName:s})}}}),W="_container_n5y84_5",G="_usersContainer_n5y84_13",j="_buttonContainer_n5y84_17",x="_setupInfoContainer_n5y84_23",Y="_alert_n5y84_27",q={container:W,usersContainer:G,buttonContainer:j,setupInfoContainer:x,alert:Y};function H(e,s,d,X,Z,ee){const w=t("n8n-heading"),y=t("n8n-button"),U=t("n8n-tooltip"),T=t("n8n-action-box"),L=t("n8n-link"),C=t("i18n-t"),$=t("n8n-notice"),f=t("n8n-option"),k=t("n8n-select"),M=t("n8n-users-list");return n(),l("div",{class:g(e.$style.container)},[p("div",null,[i(w,{size:"2xlarge"},{default:o(()=>[v(S(e.$locale.baseText("settings.users")),1)]),_:1}),e.showUMSetupWarning?u("",!0):(n(),l("div",{key:0,class:g(e.$style.buttonContainer)},[i(U,{disabled:!e.ssoStore.isSamlLoginEnabled},{content:o(()=>[p("span",null,S(e.$locale.baseText("settings.users.invite.tooltip")),1)]),default:o(()=>[p("div",null,[i(y,{disabled:e.ssoStore.isSamlLoginEnabled||!e.settingsStore.isBelowUserQuota,label:e.$locale.baseText("settings.users.invite"),size:"large","data-test-id":"settings-users-invite-button",onClick:e.onInvite},null,8,["disabled","label","onClick"])])]),_:1},8,["disabled"])],2))]),e.settingsStore.isBelowUserQuota?u("",!0):(n(),l("div",{key:0,class:g(e.$style.setupInfoContainer)},[i(T,{heading:e.$locale.baseText(e.uiStore.contextBasedTranslationKeys.users.settings.unavailable.title),description:e.$locale.baseText(e.uiStore.contextBasedTranslationKeys.users.settings.unavailable.description),"button-text":e.$locale.baseText(e.uiStore.contextBasedTranslationKeys.users.settings.unavailable.button),"onClick:button":e.goToUpgrade},null,8,["heading","description","button-text","onClick:button"])],2)),e.isAdvancedPermissionsEnabled?u("",!0):(n(),m($,{key:1},{default:o(()=>[i(C,{keypath:"settings.users.advancedPermissions.warning"},{link:o(()=>[i(L,{size:"small",onClick:e.goToUpgradeAdvancedPermissions},{default:o(()=>[v(S(e.$locale.baseText("settings.users.advancedPermissions.warning.link")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})),e.settingsStore.isBelowUserQuota||e.usersStore.allUsers.length>1?(n(),l("div",{key:2,class:g(e.$style.usersContainer)},[i(M,{actions:e.usersListActions,users:e.usersStore.allUsers,"current-user-id":e.usersStore.currentUserId,"is-saml-login-enabled":e.ssoStore.isSamlLoginEnabled,onDelete:e.onDelete,onReinvite:e.onReinvite,onCopyInviteLink:e.onCopyInviteLink,onCopyPasswordResetLink:e.onCopyPasswordResetLink,onAllowSSOManualLogin:e.onAllowSSOManualLogin,onDisallowSSOManualLogin:e.onDisallowSSOManualLogin},{actions:o(({user:r})=>[r.id!==e.usersStore.currentUserId?(n(),m(k,{key:0,"model-value":(r==null?void 0:r.role)||"global:member",disabled:!e.canUpdateRole,"data-test-id":"user-role-select","onUpdate:modelValue":a=>e.onRoleChange(r,a)},{default:o(()=>[(n(!0),l(F,null,z(e.userRoles,a=>(n(),m(f,{key:a.value,value:a.value,label:a.label,disabled:a.disabled},null,8,["value","label","disabled"]))),128))]),_:2},1032,["model-value","disabled","onUpdate:modelValue"])):u("",!0)]),_:1},8,["actions","users","current-user-id","is-saml-login-enabled","onDelete","onReinvite","onCopyInviteLink","onCopyPasswordResetLink","onAllowSSOManualLogin","onDisallowSSOManualLogin"])],2)):u("",!0)],2)}const J={$style:q},_e=A(K,[["render",H],["__cssModules",J]]);export{_e as default};
//# sourceMappingURL=SettingsUsersView-3QMZhvvB.js.map
