import{m as A}from"./pinia-aUqqC48i.js";import{v as V,a9 as L,e3 as j,g5 as H,a5 as O,_ as B}from"./n8n-_nNvRoCf.js";import{D as F}from"./NodeView-e_zfgMVH.js";import{M as W,_ as J}from"./TextWithHighlights.vue_vue_type_script_setup_true_lang-OUCPnKVA.js";import{aP as R}from"./index-xP-VuMjv.js";import{G,ag as v,l as r,m as l,I as n,p as s,F as M,a7 as E,T as g,O as d,R as $,S as k,Q as S,M as N}from"./vendor-NNwioulI.js";import"./lodash-es-5z_C16pm.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./esprima-next-ulPLCZ1Z.js";import"./luxon-ZRIU05qF.js";import"./@vueuse/core-8g26_cc0.js";import"./uuid-McvpxQtQ.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./useExecutionDebugging-GoiwhZAw.js";import"./file-saver-GLtlGJrO.js";import"./vue-json-pretty-AIiKR_BZ.js";import"./dateFormatter-e3zTcyK4.js";import"./RunDataAi-WDp0ZlAg.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";import"./workflowActivate-taS2Qpdq.js";import"./collaboration.store-emJMSzVB.js";const _=40,U=G({name:"RunDataTable",components:{Draggable:F,MappingPill:W,TextWithHighlights:J},props:{node:{type:Object},inputData:{type:Array},mappingEnabled:{type:Boolean},distanceFromActive:{type:Number},runIndex:{type:Number},outputIndex:{type:Number},totalRuns:{type:Number},pageOffset:{type:Number},hasDefaultHoverState:{type:Boolean},search:{type:String}},setup(){return{externalHooks:O()}},data(){return{activeColumn:-1,forceShowGrip:!1,draggedColumn:!1,draggingPath:null,hoveringPath:null,mappingHintVisible:!1,activeRow:null,columnLimit:_,columnLimitExceeded:!1}},mounted(){if(this.tableData&&this.tableData.columns&&this.$refs.draggable){const e=this.$refs.draggable.$refs.wrapper;e&&this.$emit("mounted",{avgRowHeight:e.offsetHeight/this.tableData.data.length})}},computed:{...A(L,V),hoveringItem(){return this.ndvStore.hoveringItem},pairedItemMappings(){return this.workflowsStore.workflowExecutionPairedItemMappings},tableData(){return this.convertToTable(this.inputData)},focusedMappableInput(){return this.ndvStore.focusedMappableInput}},methods:{shorten:j,isHoveringRow(e){if(e===this.activeRow)return!0;const t=this.pageOffset+e;if(t===0&&!this.hoveringItem&&this.hasDefaultHoverState&&this.distanceFromActive===1)return!0;const a=H(this.node.name,this.runIndex||0,this.outputIndex||0,t);if(!this.hoveringItem||!this.pairedItemMappings[a])return!1;const m=H(this.hoveringItem.nodeName,this.hoveringItem.runIndex,this.hoveringItem.outputIndex,this.hoveringItem.itemIndex);return this.pairedItemMappings[a].has(m)},onMouseEnterCell(e){const t=e.target;if(t&&this.mappingEnabled){const a=t.dataset.col;a&&!isNaN(parseInt(a,10))&&(this.activeColumn=parseInt(a,10))}if(t){const a=t.dataset.row;a&&!isNaN(parseInt(a,10))&&(this.activeRow=parseInt(a,10),this.$emit("activeRowChanged",this.pageOffset+this.activeRow))}},onMouseLeaveCell(){this.activeColumn=-1,this.activeRow=null,this.$emit("activeRowChanged",null)},onMouseEnterKey(e,t){this.hoveringPath=this.getCellExpression(e,t)},onMouseLeaveKey(){this.hoveringPath=null},isHovering(e,t){const a=this.getCellExpression(e,t);return this.hoveringPath===a},getExpression(e){return this.node?R({nodeName:this.node.name,distanceFromActive:this.distanceFromActive,path:[e]}):""},getPathNameFromTarget(e){return e?e.dataset.name:""},getCellPathName(e,t){const a=e[e.length-1];return typeof a=="string"?a:e.length>1?`${e[e.length-2]}[${a}]`:`${this.tableData.columns[t]}[${a}]`},getCellExpression(e,t){if(!this.node)return"";const a=this.tableData.columns[t];return R({nodeName:this.node.name,distanceFromActive:this.distanceFromActive,path:[a,...e]})},isEmpty(e){return e===""||Array.isArray(e)&&e.length===0||typeof e=="object"&&e!==null&&Object.keys(e).length===0||e===null||e===void 0},getValueToRender(e){return e===""?this.$locale.baseText("runData.emptyString"):typeof e=="string"?e.replaceAll(`
`,"\\n"):Array.isArray(e)&&e.length===0?this.$locale.baseText("runData.emptyArray"):typeof e=="object"&&e!==null&&Object.keys(e).length===0?this.$locale.baseText("runData.emptyObject"):e==null?`[${e}]`:e===!0||e===!1||typeof e=="number"?e.toString():e},onDragStart(){this.draggedColumn=!0,this.ndvStore.resetMappingTelemetry()},onCellDragStart(e){e!=null&&e.dataset.value&&(this.draggingPath=e.dataset.value),this.onDragStart()},onCellDragEnd(e){this.draggingPath=null,this.onDragEnd(e.dataset.name||"","tree",e.dataset.depth||"0")},isDraggingKey(e,t){if(this.draggingPath)return this.draggingPath===this.getCellExpression(e,t)},onDragEnd(e,t,a="0"){setTimeout(()=>{const m=this.ndvStore.mappingTelemetry,h={src_node_type:this.node.type,src_field_name:e,src_nodes_back:this.distanceFromActive,src_run_index:this.runIndex,src_runs_total:this.totalRuns,src_field_nest_level:parseInt(a,10),src_view:"table",src_element:t,success:!1,...m};this.externalHooks.run("runDataTable.onDragEnd",h),this.$telemetry.track("User dragged data for mapping",h)},1e3)},isSimple(e){return typeof e!="object"||e===null||Array.isArray(e)&&e.length===0||typeof e=="object"&&Object.keys(e).length===0},hasJsonInColumn(e){return this.tableData.hasJson[this.tableData.columns[e]]},convertToTable(e){const t=[],a=[];let m,h,c;const C={};return e.forEach(y=>{if(!y.hasOwnProperty("json"))return;c=y.json,h=[];const D=Object.keys(c||{});D.length>_?(this.columnLimitExceeded=!0,m=D.slice(0,_)):m=D,a.forEach(o=>{c.hasOwnProperty(o)?(h.push(c[o]),m.splice(m.indexOf(o),1),C[o]=C[o]||typeof c[o]=="object"&&Object.keys(c[o]||{}).length>0||!1):h.push(void 0)}),m.forEach(o=>{a.push(o),h.push(c[o]),C[o]=C[o]||typeof c[o]=="object"&&Object.keys(c[o]||{}).length>0||!1}),t.push(h)}),t.forEach(y=>{a.length>y.length&&y.push(...new Array(a.length-y.length))}),{hasJson:C,columns:a,data:t}},switchToJsonView(){this.$emit("displayModeChange","json")}},watch:{focusedMappableInput(e){setTimeout(()=>{this.forceShowGrip=!!this.focusedMappableInput},e?300:150)}}}),z="/static/data-mapping-gif.gif",Q="_dataDisplay_1krqo_5",X="_table_1krqo_18",Y="_nodeClass_1krqo_66",Z="_emptyCell_1krqo_70",x="_header_1krqo_74",ee="_draggableHeader_1krqo_86",te="_dragButton_1krqo_90",ae="_draggingHeader_1krqo_94",ne="_activeHeader_1krqo_98",oe="_dataKey_1krqo_107",se="_value_1krqo_116",re="_nestedValue_1krqo_120 _value_1krqo_116",ie="_mappable_1krqo_125",le="_empty_1krqo_70",de="_limitColWidth_1krqo_133",pe="_minColWidth_1krqo_137",ge="_hoveringKey_1krqo_141",me="_draggingKey_1krqo_145",ue="_tableRightMargin_1krqo_149",he="_hoveringRow_1krqo_157",ce="_warningTooltip_1krqo_162",ye={dataDisplay:Q,table:X,nodeClass:Y,emptyCell:Z,header:x,draggableHeader:ee,dragButton:te,draggingHeader:ae,activeHeader:ne,dataKey:oe,value:se,nestedValue:re,mappable:ie,empty:le,limitColWidth:de,minColWidth:pe,hoveringKey:ge,draggingKey:me,tableRightMargin:ue,hoveringRow:he,warningTooltip:ce},be=["data-row"],fe=s("img",{src:z},null,-1),ve=["data-test-id"],Ce=["data-row","data-col"],De=["data-name","data-value","data-depth","onMouseenter"],we={key:0};function $e(e,t,a,m,h,c){const C=v("n8n-info-tip"),y=v("MappingPill"),D=v("TextWithHighlights"),o=v("font-awesome-icon"),I=v("Draggable"),T=v("n8n-tooltip"),P=v("i18n-t"),q=v("n8n-tree");return r(),l("div",{class:n(e.$style.dataDisplay)},[e.tableData.columns&&e.tableData.columns.length===0?(r(),l("table",{key:0,class:n(e.$style.table)},[s("tr",null,[s("th",{class:n(e.$style.emptyCell)},null,2),s("th",{class:n(e.$style.tableRightMargin)},null,2)]),(r(!0),l(M,null,E(e.tableData.data,(u,p)=>(r(),l("tr",{key:p,class:n({[e.$style.hoveringRow]:e.isHoveringRow(p)})},[s("td",{"data-row":p,"data-col":0,onMouseenter:t[0]||(t[0]=(...i)=>e.onMouseEnterCell&&e.onMouseEnterCell(...i)),onMouseleave:t[1]||(t[1]=(...i)=>e.onMouseLeaveCell&&e.onMouseLeaveCell(...i))},[g(C,null,{default:d(()=>[k($(e.$locale.baseText("runData.emptyItemHint")),1)]),_:1})],40,be),s("td",{class:n(e.$style.tableRightMargin)},null,2)],2))),128))],2)):(r(),l("table",{key:1,class:n(e.$style.table)},[s("thead",null,[s("tr",null,[(r(!0),l(M,null,E(e.tableData.columns||[],(u,p)=>(r(),l("th",{key:u},[g(T,{placement:"bottom-start",disabled:!e.mappingEnabled,"show-after":1e3},{content:d(()=>[s("div",null,[fe,k(" "+$(e.$locale.baseText("dataMapping.dragColumnToFieldHint")),1)])]),default:d(()=>[g(I,{type:"mapping",data:e.getExpression(u),disabled:!e.mappingEnabled,onDragstart:e.onDragStart,onDragend:i=>e.onDragEnd(i,"column")},{preview:d(({canDrop:i})=>[g(y,{html:e.shorten(u,16,2),"can-drop":i},null,8,["html","can-drop"])]),default:d(({isDragging:i})=>[s("div",{class:n({[e.$style.header]:!0,[e.$style.draggableHeader]:e.mappingEnabled,[e.$style.activeHeader]:(p===e.activeColumn||e.forceShowGrip)&&e.mappingEnabled,[e.$style.draggingHeader]:i})},[g(D,{content:e.getValueToRender(u||""),search:e.search},null,8,["content","search"]),s("div",{class:n(e.$style.dragButton)},[g(o,{icon:"grip-vertical"})],2)],2)]),_:2},1032,["data","disabled","onDragstart","onDragend"])]),_:2},1032,["disabled"])]))),128)),e.columnLimitExceeded?(r(),l("th",{key:0,class:n(e.$style.header)},[g(T,{placement:"bottom-end"},{content:d(()=>[s("div",null,[g(P,{tag:"span",keypath:"dataMapping.tableView.tableColumnsExceeded.tooltip"},{columnLimit:d(()=>[k($(e.columnLimit),1)]),link:d(()=>[s("a",{onClick:t[2]||(t[2]=(...u)=>e.switchToJsonView&&e.switchToJsonView(...u))},$(e.$locale.baseText("dataMapping.tableView.tableColumnsExceeded.tooltip.link")),1)]),_:1})])]),default:d(()=>[s("span",null,[g(o,{class:n(e.$style.warningTooltip),icon:"exclamation-triangle"},null,8,["class"]),k(" "+$(e.$locale.baseText("dataMapping.tableView.tableColumnsExceeded")),1)])]),_:1})],2)):S("",!0),s("th",{class:n(e.$style.tableRightMargin)},null,2)])]),g(I,{ref:"draggable",tag:"tbody",type:"mapping","target-data-key":"mappable",disabled:!e.mappingEnabled,onDragstart:e.onCellDragStart,onDragend:e.onCellDragEnd},{preview:d(({canDrop:u,el:p})=>[g(y,{html:e.shorten(e.getPathNameFromTarget(p)||"",16,2),"can-drop":u},null,8,["html","can-drop"])]),default:d(()=>[(r(!0),l(M,null,E(e.tableData.data,(u,p)=>(r(),l("tr",{key:p,class:n({[e.$style.hoveringRow]:e.isHoveringRow(p)}),"data-test-id":e.isHoveringRow(p)?"hovering-item":void 0},[(r(!0),l(M,null,E(u,(i,b)=>(r(),l("td",{key:b,"data-row":p,"data-col":b,class:n(e.hasJsonInColumn(b)?e.$style.minColWidth:e.$style.limitColWidth),onMouseenter:t[4]||(t[4]=(...f)=>e.onMouseEnterCell&&e.onMouseEnterCell(...f)),onMouseleave:t[5]||(t[5]=(...f)=>e.onMouseLeaveCell&&e.onMouseLeaveCell(...f))},[e.isSimple(i)?(r(),N(D,{key:0,content:e.getValueToRender(i),search:e.search,class:n({[e.$style.value]:!0,[e.$style.empty]:e.isEmpty(i)})},null,8,["content","search","class"])):(r(),N(q,{key:1,"node-class":e.$style.nodeClass,value:i},{label:d(({label:f,path:w})=>[s("span",{class:n({[e.$style.hoveringKey]:e.mappingEnabled&&e.isHovering(w,b),[e.$style.draggingKey]:e.isDraggingKey(w,b),[e.$style.dataKey]:!0,[e.$style.mappable]:e.mappingEnabled}),"data-target":"mappable","data-name":e.getCellPathName(w,b),"data-value":e.getCellExpression(w,b),"data-depth":w.length,onMouseenter:()=>e.onMouseEnterKey(w,b),onMouseleave:t[3]||(t[3]=(...K)=>e.onMouseLeaveKey&&e.onMouseLeaveKey(...K))},$(f||e.$locale.baseText("runData.unnamedField")),43,De)]),value:d(({value:f})=>[g(D,{content:e.getValueToRender(f),search:e.search,class:n({[e.$style.nestedValue]:!0,[e.$style.empty]:e.isEmpty(f)})},null,8,["content","search","class"])]),_:2},1032,["node-class","value"]))],42,Ce))),128)),e.columnLimitExceeded?(r(),l("td",we)):S("",!0),s("td",{class:n(e.$style.tableRightMargin)},null,2)],10,ve))),128))]),_:1},8,["disabled","onDragstart","onDragend"])],2))],2)}const Me={$style:ye},lt=B(U,[["render",$e],["__cssModules",Me]]);export{lt as default};
//# sourceMappingURL=RunDataTable-5BP-mJaN.js.map
