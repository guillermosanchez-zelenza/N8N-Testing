import{G as J,aI as Q,aJ as H,r as b,e as A,b as X,ag as u,l as i,m as d,T as l,O as s,S as p,R as o,u as t,M as k,I as r,Q as h,p as g,J as Y,a2 as Z}from"./vendor-NNwioulI.js";import{d as ee}from"./index-xP-VuMjv.js";import{u as te,e as ae,h as ne,bm as se,b as n,fT as oe,fU as ie,_ as le}from"./n8n-_nNvRoCf.js";import"./pinia-aUqqC48i.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./lodash-es-5z_C16pm.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./uuid-McvpxQtQ.js";import"./luxon-ZRIU05qF.js";import"./esprima-next-ulPLCZ1Z.js";import"./@vueuse/core-8g26_cc0.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";const ce={class:"settings-usage-and-plan"},re={key:1},ue={key:0},de={key:1},pe={key:0},ge={key:1},_e=["href"],me=["href"],ye=J({__name:"SettingsUsageAndPlan",setup(Ce){const a=ee(),P=Q(),I=H(),V=te(),x=ae(),T=b(`callback=${encodeURIComponent(`${window.location.origin}${window.location.pathname}`)}`),j=A(()=>`${a.viewPlansUrl}&${T.value}&source=usage_page`),S=A(()=>`${a.managePlanUrl}&${T.value}`),_=b(!1),y=b(""),w=b(null),$=A(()=>ne(["role"],{role:[se.Owner]})),L=()=>{x.showMessage({type:"success",title:n.baseText("settings.usageAndPlan.license.activation.success.title"),message:n.baseText("settings.usageAndPlan.license.activation.success.message",{interpolate:{name:a.planName,type:a.planId?n.baseText("settings.usageAndPlan.plan"):n.baseText("settings.usageAndPlan.edition")}})})},C=e=>{x.showError(e,n.baseText("settings.usageAndPlan.license.activation.error.title"),e.message)},q=async()=>{try{await a.activateLicense(y.value),_.value=!1,L()}catch(e){C(e)}};X(async()=>{if(!a.isDesktop){if(a.setLoading(!0),P.query.key)try{await a.activateLicense(P.query.key),await I.replace({query:{}}),L(),a.setLoading(!1);return}catch(e){C(e)}try{!P.query.key&&$.value?await a.refreshLicenseManagementToken():await a.getLicenseInfo(),a.setLoading(!1)}catch(e){e.name||(e.name=n.baseText("settings.usageAndPlan.error")),x.showError(e,e.name,e.message)}}});const v=e=>{const c=a.telemetryPayload;c.action=e,ie.track("User clicked button on usage page",c)},M=()=>{_.value=!0,v("add_activation_key")},N=()=>{V.goToUpgrade("usage_page","open"),v("view_plans")},z=()=>{v("manage_plan")},R=()=>{y.value=""},D=()=>{var e;(e=w.value)==null||e.focus()},E=()=>{v("desktop_view_plans"),window.open(oe,"_blank")};return(e,c)=>{const U=u("n8n-heading"),K=u("n8n-action-box"),B=u("i18n-t"),O=u("n8n-text"),W=u("n8n-info-tip"),m=u("n8n-button"),F=u("n8n-input"),G=u("el-dialog");return i(),d("div",ce,[l(U,{size:"2xlarge"},{default:s(()=>[p(o(t(n).baseText("settings.usageAndPlan.title")),1)]),_:1}),t(a).isDesktop?(i(),k(K,{key:0,class:r(e.$style.actionBox),heading:t(n).baseText("settings.usageAndPlan.desktop.title"),description:t(n).baseText("settings.usageAndPlan.desktop.description"),"button-text":t(n).baseText("settings.usageAndPlan.button.plans"),"onClick:button":E},null,8,["class","heading","description","button-text"])):h("",!0),!t(a).isDesktop&&!t(a).isLoading?(i(),d("div",re,[l(U,{class:r(e.$style.title),size:"large"},{default:s(()=>[l(B,{keypath:"settings.usageAndPlan.description",tag:"span"},{name:s(()=>[p(o(t(a).planName),1)]),type:s(()=>[t(a).planId?(i(),d("span",ue,o(t(n).baseText("settings.usageAndPlan.plan")),1)):(i(),d("span",de,o(t(n).baseText("settings.usageAndPlan.edition")),1))]),_:1})]),_:1},8,["class"]),g("div",{class:r(e.$style.quota)},[l(O,{size:"medium",color:"text-light"},{default:s(()=>[p(o(t(n).baseText("settings.usageAndPlan.activeWorkflows")),1)]),_:1}),g("div",{class:r(e.$style.chart)},[t(a).executionLimit>0?(i(),d("span",{key:0,class:r(e.$style.chartLine)},[g("span",{class:r(e.$style.chartBar),style:Y({width:`${t(a).executionPercentage}%`})},null,6)],2)):h("",!0),l(B,{tag:"span",class:r(e.$style.count),keypath:"settings.usageAndPlan.activeWorkflows.count"},{count:s(()=>[p(o(t(a).executionCount),1)]),limit:s(()=>[t(a).executionLimit<0?(i(),d("span",pe,o(t(n).baseText("settings.usageAndPlan.activeWorkflows.unlimited")),1)):(i(),d("span",ge,o(t(a).executionLimit),1))]),_:1},8,["class"])],2)],2),l(W,null,{default:s(()=>[p(o(t(n).baseText("settings.usageAndPlan.activeWorkflows.hint")),1)]),_:1}),g("div",{class:r(e.$style.buttons)},[$.value?(i(),k(m,{key:0,class:r(e.$style.buttonTertiary),type:"tertiary",size:"large",onClick:M},{default:s(()=>[g("span",null,o(t(n).baseText("settings.usageAndPlan.button.activation")),1)]),_:1},8,["class"])):h("",!0),t(a).managementToken?(i(),k(m,{key:1,size:"large",onClick:z},{default:s(()=>[g("a",{href:S.value,target:"_blank"},o(t(n).baseText("settings.usageAndPlan.button.manage")),9,_e)]),_:1})):(i(),k(m,{key:2,size:"large",onClick:Z(N,["prevent"])},{default:s(()=>[g("a",{href:j.value,target:"_blank"},o(t(n).baseText("settings.usageAndPlan.button.plans")),9,me)]),_:1},8,["onClick"]))],2),l(G,{modelValue:_.value,"onUpdate:modelValue":c[2]||(c[2]=f=>_.value=f),width:"480px",top:"0",title:t(n).baseText("settings.usageAndPlan.dialog.activation.title"),"modal-class":e.$style.center,onClosed:R,onOpened:D},{default:s(()=>[l(F,{ref_key:"activationKeyInput",ref:w,modelValue:y.value,"onUpdate:modelValue":c[0]||(c[0]=f=>y.value=f),placeholder:t(n).baseText("settings.usageAndPlan.dialog.activation.label")},null,8,["modelValue","placeholder"])]),footer:s(()=>[l(m,{type:"secondary",onClick:c[1]||(c[1]=f=>_.value=!1)},{default:s(()=>[p(o(t(n).baseText("settings.usageAndPlan.dialog.activation.cancel")),1)]),_:1}),l(m,{onClick:q},{default:s(()=>[p(o(t(n).baseText("settings.usageAndPlan.dialog.activation.activate")),1)]),_:1})]),_:1},8,["modelValue","title","modal-class"])])):h("",!0)])}}}),ve="_center_iajr8_5",fe="_actionBox_iajr8_9",be="_spacedFlex_iajr8_13",ke="_title_iajr8_19",he="_quota_iajr8_24",Pe="_count_iajr8_36",xe="_buttons_iajr8_41",Ae="_chart_iajr8_57",Te="_chartLine_iajr8_64",we="_chartBar_iajr8_74",$e={center:ve,actionBox:fe,spacedFlex:be,title:ke,quota:he,count:Pe,buttons:xe,chart:Ae,chartLine:Te,chartBar:we},Le={$style:$e},st=le(ye,[["__cssModules",Le],["__scopeId","data-v-fd69aaff"]]);export{st as default};
//# sourceMappingURL=SettingsUsageAndPlan-FhHPSwr1.js.map
