import{aF as N,u as v,ec as L,_ as A,e as D,l as O,aI as f,fF as w,fG as x,aG as V,a5 as j}from"./n8n-_nNvRoCf.js";import{m as I}from"./pinia-aUqqC48i.js";import{G as P,ag as l,l as t,m as s,I as o,T as a,p as c,O as i,S as k,R as r,F as b,a7 as S,M as h,Q as M}from"./vendor-NNwioulI.js";import{p as $}from"./pushConnection-PNUo6dZ9.js";import{ay as z}from"./index-xP-VuMjv.js";import"./lodash-es-5z_C16pm.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./esprima-next-ulPLCZ1Z.js";import"./luxon-ZRIU05qF.js";import"./@vueuse/core-8g26_cc0.js";import"./uuid-McvpxQtQ.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";import"./collaboration.store-emJMSzVB.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";const R=P({name:"CommunityPackageCard",props:{communityPackage:{type:Object},loading:{type:Boolean,default:!1}},data(){return{packageActions:[{label:this.$locale.baseText("settings.communityNodes.viewDocsAction.label"),value:N.VIEW_DOCS,type:"external-link"},{label:this.$locale.baseText("settings.communityNodes.uninstallAction.label"),value:N.UNINSTALL}]}},computed:{...I(v)},methods:{async onAction(e){switch(e){case N.VIEW_DOCS:this.$telemetry.track("user clicked to browse the cnr package documentation",{package_name:this.communityPackage.packageName,package_version:this.communityPackage.installedVersion}),window.open(`${L}${this.communityPackage.packageName}`,"_blank");break;case N.UNINSTALL:this.uiStore.openCommunityPackageUninstallConfirmModal(this.communityPackage.packageName);break}},onUpdateClick(){this.uiStore.openCommunityPackageUpdateConfirmModal(this.communityPackage.packageName)}}}),G="_cardContainer_14eyd_5",H="_packageCard_14eyd_13",Y="_cardSkeleton_14eyd_14",K="_loader_14eyd_28",F="_cardInfoContainer_14eyd_39",Q="_cardTitle_14eyd_44",W="_cardSubtitle_14eyd_51",q="_cardControlsContainer_14eyd_56",J="_cardActions_14eyd_62",X={cardContainer:G,packageCard:H,cardSkeleton:Y,loader:K,cardInfoContainer:F,cardTitle:Q,cardSubtitle:W,cardControlsContainer:q,cardActions:J},Z={key:0};function ee(e,m,n,d,_,U){const C=l("n8n-loading"),u=l("n8n-text"),y=l("n8n-icon"),p=l("n8n-tooltip"),g=l("n8n-button"),E=l("n8n-action-toggle");return t(),s("div",{class:o(e.$style.cardContainer)},[e.loading?(t(),s("div",{key:0,class:o(e.$style.cardSkeleton)},[a(C,{class:o(e.$style.loader),variant:"p",rows:1},null,8,["class"]),a(C,{class:o(e.$style.loader),variant:"p",rows:1},null,8,["class"])],2)):(t(),s("div",{key:1,class:o(e.$style.packageCard)},[c("div",{class:o(e.$style.cardInfoContainer)},[c("div",{class:o(e.$style.cardTitle)},[a(u,{bold:!0,size:"large"},{default:i(()=>[k(r(e.communityPackage.packageName),1)]),_:1})],2),c("div",{class:o(e.$style.cardSubtitle)},[a(u,{bold:!0,size:"small",color:"text-light"},{default:i(()=>[k(r(e.$locale.baseText("settings.communityNodes.packageNodes.label",{adjustToNumber:e.communityPackage.installedNodes.length}))+":Â  ",1)]),_:1}),a(u,{size:"small",color:"text-light"},{default:i(()=>[(t(!0),s(b,null,S(e.communityPackage.installedNodes,(T,B)=>(t(),s("span",{key:T.name},[k(r(T.name),1),B!=e.communityPackage.installedNodes.length-1?(t(),s("span",Z,",")):M("",!0)]))),128))]),_:1})],2)],2),c("div",{class:o(e.$style.cardControlsContainer)},[a(u,{bold:!0,size:"large",color:"text-light"},{default:i(()=>[k(" v"+r(e.communityPackage.installedVersion),1)]),_:1}),e.communityPackage.failedLoading===!0?(t(),h(p,{key:0,placement:"top"},{content:i(()=>[c("div",null,r(e.$locale.baseText("settings.communityNodes.failedToLoad.tooltip")),1)]),default:i(()=>[a(y,{icon:"exclamation-triangle",color:"danger",size:"large"})]),_:1})):e.communityPackage.updateAvailable?(t(),h(p,{key:1,placement:"top"},{content:i(()=>[c("div",null,r(e.$locale.baseText("settings.communityNodes.updateAvailable.tooltip")),1)]),default:i(()=>[a(g,{outline:"",label:"Update",onClick:e.onUpdateClick},null,8,["onClick"])]),_:1})):(t(),h(p,{key:2,placement:"top"},{content:i(()=>[c("div",null,r(e.$locale.baseText("settings.communityNodes.upToDate.tooltip")),1)]),default:i(()=>[a(y,{icon:"check-circle",color:"text-light",size:"large"})]),_:1})),c("div",{class:o(e.$style.cardActions)},[a(E,{actions:e.packageActions,onAction:e.onAction},null,8,["actions","onAction"])],2)],2)],2))],2)}const te={$style:X},oe=A(R,[["render",ee],["__cssModules",te]]),ae=31,ne=P({name:"SettingsCommunityNodesView",components:{CommunityPackageCard:oe},mixins:[$],setup(e,m){var d,_;return{externalHooks:j(),...D(),...(_=(d=$).setup)==null?void 0:_.call(d,e,m)}},data(){return{loading:!1}},async mounted(){this.pushStore.pushConnect();try{this.loading=!0,await this.communityNodesStore.fetchInstalledPackages();const e=this.communityNodesStore.getInstalledPackages,m=e.filter(n=>n.updateAvailable);this.$telemetry.track("user viewed cnr settings page",{num_of_packages_installed:e.length,installed_packages:e.map(n=>({package_name:n.packageName,package_version:n.installedVersion,package_nodes:n.installedNodes.map(d=>`${d.name}-v${d.latestVersion}`),is_update_available:n.updateAvailable!==void 0})),packages_to_update:m.map(n=>({package_name:n.packageName,package_version_current:n.installedVersion,package_version_available:n.updateAvailable})),number_of_updates_available:m.length})}catch(e){this.showError(e,this.$locale.baseText("settings.communityNodes.fetchError.title"),this.$locale.baseText("settings.communityNodes.fetchError.message"))}finally{this.loading=!1}try{await this.communityNodesStore.fetchAvailableCommunityPackageCount()}finally{this.loading=!1}},beforeUnmount(){this.pushStore.pushDisconnect()},computed:{...I(z,O,v),getEmptyStateDescription(){const e=this.communityNodesStore.availablePackageCount;return this.settingsStore.isDesktopDeployment?this.$locale.baseText("contextual.communityNodes.unavailable.description.desktop"):e<ae?this.$locale.baseText("settings.communityNodes.empty.description.no-packages",{interpolate:{docURL:f}}):this.$locale.baseText("settings.communityNodes.empty.description",{interpolate:{docURL:f,count:(Math.floor(e/10)*10).toString()}})},getEmptyStateButtonText(){return this.settingsStore.isDesktopDeployment?this.$locale.baseText("contextual.communityNodes.unavailable.button.desktop"):this.shouldShowInstallButton?this.$locale.baseText("settings.communityNodes.empty.installPackageLabel"):""},shouldShowInstallButton(){return this.settingsStore.isDesktopDeployment||this.settingsStore.isNpmAvailable},actionBoxConfig(){return this.settingsStore.isNpmAvailable?this.settingsStore.isQueueModeEnabled?{calloutText:this.$locale.baseText("settings.communityNodes.queueMode.warning",{interpolate:{docURL:x}}),calloutTheme:"warning",hideButton:!0}:{calloutText:"",calloutTheme:"",hideButton:!1}:{calloutText:this.$locale.baseText("settings.communityNodes.npmUnavailable.warning",{interpolate:{npmUrl:w}}),calloutTheme:"warning",hideButton:!0}}},methods:{onClickEmptyStateButton(){if(this.settingsStore.isDesktopDeployment)return this.goToUpgrade();this.openInstallModal()},goToUpgrade(){this.uiStore.goToUpgrade("community-nodes","upgrade-community-nodes")},openInstallModal(){const e={is_empty_state:this.communityNodesStore.getInstalledPackages.length===0};this.$telemetry.track("user clicked cnr install button",e),this.externalHooks.run("settingsCommunityNodesView.openInstallModal",e),this.uiStore.openModal(V)}}}),se="_container_12ljj_5",ie="_headingContainer_12ljj_13",le="_loadingContainer_12ljj_18",ce="_actionBoxContainer_12ljj_23",re="_cardsContainer_12ljj_27",de={container:se,headingContainer:ie,loadingContainer:le,actionBoxContainer:ce,cardsContainer:re};function me(e,m,n,d,_,U){const C=l("n8n-heading"),u=l("n8n-button"),y=l("n8n-action-box"),p=l("CommunityPackageCard");return t(),s("div",{class:o(e.$style.container)},[c("div",{class:o(e.$style.headingContainer)},[a(C,{size:"2xlarge"},{default:i(()=>[k(r(e.$locale.baseText("settings.communityNodes")),1)]),_:1}),!e.settingsStore.isQueueModeEnabled&&e.communityNodesStore.getInstalledPackages.length>0&&!e.loading?(t(),h(u,{key:0,label:e.$locale.baseText("settings.communityNodes.installModal.installButton.label"),size:"large",onClick:e.openInstallModal},null,8,["label","onClick"])):M("",!0)],2),e.settingsStore.isQueueModeEnabled?(t(),s("div",{key:0,class:o(e.$style.actionBoxContainer)},[a(y,{heading:e.$locale.baseText("settings.communityNodes.empty.title"),description:e.getEmptyStateDescription,"callout-text":e.actionBoxConfig.calloutText,"callout-theme":e.actionBoxConfig.calloutTheme},null,8,["heading","description","callout-text","callout-theme"])],2)):e.loading?(t(),s("div",{key:1,class:o(e.$style.cardsContainer)},[(t(),s(b,null,S(2,g=>a(p,{key:"index-"+g,loading:!0})),64))],2)):e.communityNodesStore.getInstalledPackages.length===0?(t(),s("div",{key:2,class:o(e.$style.actionBoxContainer)},[a(y,{heading:e.$locale.baseText("settings.communityNodes.empty.title"),description:e.getEmptyStateDescription,"button-text":e.getEmptyStateButtonText,"callout-text":e.actionBoxConfig.calloutText,"callout-theme":e.actionBoxConfig.calloutTheme,"onClick:button":e.onClickEmptyStateButton},null,8,["heading","description","button-text","callout-text","callout-theme","onClick:button"])],2)):(t(),s("div",{key:3,class:o(e.$style.cardsContainer)},[(t(!0),s(b,null,S(e.communityNodesStore.getInstalledPackages,g=>(t(),h(p,{key:g.packageName,"community-package":g},null,8,["community-package"]))),128))],2))],2)}const ue={$style:de},Ge=A(ne,[["render",me],["__cssModules",ue]]);export{Ge as default};
//# sourceMappingURL=SettingsCommunityNodesView-lwCnYeAK.js.map
