import{R as M}from"./ResourcesListLayout--pg3flTX.js";import{t as v,f as E,u as A,B as k,K as F,dw as z,a6 as O,_ as L,y as P,bo as V}from"./n8n-_nNvRoCf.js";import{aB as R,aI as H,a as W,G as q,c as Y}from"./index-xP-VuMjv.js";import{m as w}from"./pinia-aUqqC48i.js";import{G as N,ag as s,l as d,M as y,O as a,T as n,S as m,R as l,I as c,p,Q as S,a2 as G,m as I,V as $,U as g,a7 as K,F as j}from"./vendor-NNwioulI.js";import"./lodash-es-5z_C16pm.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./esprima-next-ulPLCZ1Z.js";import"./luxon-ZRIU05qF.js";import"./@vueuse/core-8g26_cc0.js";import"./uuid-McvpxQtQ.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";const u={OPEN:"open",DELETE:"delete"},Q=N({components:{TimeAgo:R,CredentialIcon:H},props:{data:{type:Object,required:!0,default:()=>({id:"",createdAt:"",updatedAt:"",type:"",name:"",nodesAccess:[],sharedWith:[],ownedBy:{}})},readonly:{type:Boolean,default:!1}},setup(){return{...W()}},data(){return{EnterpriseEditionFeature:v}},computed:{...w(k,A,E),currentUser(){return this.usersStore.currentUser},credentialType(){return this.credentialsStore.getCredentialTypeByName(this.data.type)},credentialPermissions(){return this.currentUser?F(this.currentUser,this.data):null},actions(){return this.credentialPermissions?[{label:this.$locale.baseText("credentials.item.open"),value:u.OPEN}].concat(this.credentialPermissions.delete?[{label:this.$locale.baseText("credentials.item.delete"),value:u.DELETE}]:[]):[]},formattedCreatedAtDate(){const e=new Date().getFullYear();return z(this.data.createdAt,`d mmmm${this.data.createdAt.startsWith(e)?"":", yyyy"}`)}},methods:{async onClick(e){var t;this.$refs.cardActions===e.target||(t=this.$refs.cardActions)!=null&&t.contains(e.target)||this.uiStore.openExistingCredential(this.data.id)},async onAction(e){e===u.OPEN?await this.onClick(new Event("click")):e===u.DELETE&&await this.confirm(this.$locale.baseText("credentialEdit.credentialEdit.confirmMessage.deleteCredential.message",{interpolate:{savedCredentialName:this.data.name}}),this.$locale.baseText("credentialEdit.credentialEdit.confirmMessage.deleteCredential.headline"),{confirmButtonText:this.$locale.baseText("credentialEdit.credentialEdit.confirmMessage.deleteCredential.confirmButtonText")})===O&&await this.credentialsStore.deleteCredential({id:this.data.id})}}}),J="_cardLink_1s1ie_5",X="_cardHeading_1s1ie_15",Z="_cardDescription_1s1ie_20",x="_cardActions_1s1ie_27",ee={cardLink:J,cardHeading:X,cardDescription:Z,cardActions:x},te={key:0};function se(e,t,r,f,B,D){const h=s("CredentialIcon"),C=s("n8n-heading"),_=s("TimeAgo"),T=s("n8n-text"),b=s("n8n-badge"),i=s("enterprise-edition"),o=s("n8n-action-toggle"),U=s("n8n-card");return d(),y(U,{class:c(e.$style.cardLink),onClick:e.onClick},{prepend:a(()=>[n(h,{"credential-type-name":e.credentialType?e.credentialType.name:""},null,8,["credential-type-name"])]),header:a(()=>[n(C,{tag:"h2",bold:"",class:c(e.$style.cardHeading)},{default:a(()=>[m(l(e.data.name),1)]),_:1},8,["class"])]),append:a(()=>[p("div",{ref:"cardActions",class:c(e.$style.cardActions)},[n(i,{features:[e.EnterpriseEditionFeature.Sharing]},{default:a(()=>[e.credentialPermissions.isOwner?(d(),y(b,{key:0,class:"mr-xs",theme:"tertiary",bold:""},{default:a(()=>[m(l(e.$locale.baseText("credentials.item.owner")),1)]),_:1})):S("",!0)]),_:1},8,["features"]),n(o,{actions:e.actions,theme:"dark",onAction:e.onAction,onClick:t[0]||(t[0]=G(()=>{},["stop"]))},null,8,["actions","onAction"])],2)]),default:a(()=>[p("div",{class:c(e.$style.cardDescription)},[n(T,{color:"text-light",size:"small"},{default:a(()=>[e.credentialType?(d(),I("span",te,l(e.credentialType.displayName)+" | ",1)):S("",!0),$(p("span",null,[m(l(e.$locale.baseText("credentials.item.updated"))+" ",1),n(_,{date:e.data.updatedAt},null,8,["date"]),m(" | ")],512),[[g,e.data]]),$(p("span",null,l(e.$locale.baseText("credentials.item.created"))+" "+l(e.formattedCreatedAtDate),513),[[g,e.data]])]),_:1})],2)]),_:1},8,["class","onClick"])}const ae={$style:ee},ne=L(Q,[["render",se],["__cssModules",ae]]),re=N({name:"CredentialsView",components:{ResourcesListLayout:M,CredentialCard:ne},data(){return{filters:{search:"",ownedBy:"",sharedWith:"",type:""},sourceControlStoreUnsubscribe:()=>{}}},computed:{...w(k,P,A,E,Y,q),allCredentials(){return this.credentialsStore.allCredentials},allCredentialTypes(){return this.credentialsStore.allCredentialTypes},credentialTypesById(){return this.credentialsStore.credentialTypesById}},watch:{"filters.type"(){this.sendFiltersTelemetry("type")}},mounted(){this.sourceControlStoreUnsubscribe=this.sourceControlStore.$onAction(({name:e,after:t})=>{e==="pullWorkfolder"&&t&&t(()=>{this.initialize()})})},beforeUnmount(){this.sourceControlStoreUnsubscribe()},methods:{addCredential(){this.uiStore.openModal(V),this.$telemetry.track("User clicked add cred button",{source:"Creds list"})},async initialize(){const e=[this.credentialsStore.fetchAllCredentials(),this.credentialsStore.fetchCredentialTypes(!1),this.externalSecretsStore.fetchAllSecrets(),this.nodeTypesStore.loadNodeTypesIfNotLoaded()];await Promise.all(e),await this.usersStore.fetchUsers()},onFilter(e,t,r){if(t.type.length>0&&(r=r&&t.type.includes(e.type)),t.search){const f=t.search.toLowerCase();r=r||this.credentialTypesById[e.type]&&this.credentialTypesById[e.type].displayName.toLowerCase().includes(f)}return r},sendFiltersTelemetry(e){this.$refs.layout.sendFiltersTelemetry(e)}}}),ie="_sidebarContainer_1qflh_9",oe={"type-input":"_type-input_1qflh_5",sidebarContainer:ie},le={class:"mb-s"};function de(e,t,r,f,B,D){const h=s("CredentialCard"),C=s("n8n-input-label"),_=s("n8n-option"),T=s("n8n-select"),b=s("ResourcesListLayout");return d(),y(b,{ref:"layout","resource-key":"credentials",resources:e.allCredentials,initialize:e.initialize,filters:e.filters,"additional-filters-handler":e.onFilter,"type-props":{itemSize:77},"onClick:add":e.addCredential,"onUpdate:filters":t[0]||(t[0]=i=>e.filters=i)},{default:a(({data:i})=>[n(h,{"data-test-id":"resources-list-item",class:"mb-2xs",data:i},null,8,["data"])]),filters:a(({setKeyValue:i})=>[p("div",le,[n(C,{label:e.$locale.baseText("credentials.filters.type"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),n(T,{ref:"typeInput","model-value":e.filters.type,size:"medium",multiple:"",filterable:"",class:c(e.$style["type-input"]),"onUpdate:modelValue":o=>i("type",o)},{default:a(()=>[(d(!0),I(j,null,K(e.allCredentialTypes,o=>(d(),y(_,{key:o.name,value:o.name,label:o.displayName},null,8,["value","label"]))),128))]),_:2},1032,["model-value","class","onUpdate:modelValue"])])]),_:1},8,["resources","initialize","filters","additional-filters-handler","onClick:add"])}const ce={$style:oe},Ve=L(re,[["render",de],["__cssModules",ce]]);export{Ve as default};
//# sourceMappingURL=CredentialsView-UpyCg6u-.js.map
