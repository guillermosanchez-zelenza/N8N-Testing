import{m as S}from"./pinia-aUqqC48i.js";import{T as M}from"./TemplatesInfoCarousel-FOroCegN.js";import{I as $}from"./index-xP-VuMjv.js";import{G as v,ag as l,l as n,m as h,p as i,I as s,R as p,T as a,Q as u,O as c,S as m,F as P,a7 as A,M as E,V as U,U as V}from"./vendor-NNwioulI.js";import{_,aM as I,e as q,fP as B,as as F,f as R,u as z,l as H,fJ as Q,V as T}from"./n8n-_nNvRoCf.js";import{T as j}from"./TemplateList-l63ZcdEV.js";import{T as N}from"./TemplatesView-iIGCTbv6.js";import"./NodeList-_14w6OPV.js";import"./vue-agile-opIkBolK.js";import"./lodash-es-5z_C16pm.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./uuid-McvpxQtQ.js";import"./luxon-ZRIU05qF.js";import"./esprima-next-ulPLCZ1Z.js";import"./@vueuse/core-8g26_cc0.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";const D=v({name:"TemplateFilters",props:{categories:{type:Array,default:()=>[]},sortOnPopulate:{type:Boolean,default:!1},expandLimit:{type:Number,default:12},loading:{type:Boolean},selected:{type:Array,default:()=>[]}},emits:["clearAll","select","clear"],data(){return{collapsed:!0,sortedCategories:[]}},computed:{...S($),allSelected(){return this.selected.length===0}},watch:{sortOnPopulate:{handler(e){e&&this.sortCategories()},immediate:!0},categories:{handler(e){e.length>0&&this.sortCategories()},immediate:!0}},methods:{sortCategories(){if(!this.sortOnPopulate)this.sortedCategories=this.categories;else{const e=this.selected||[],t=this.categories.filter(r=>e.includes(r)),o=this.categories.filter(r=>!e.includes(r));this.sortedCategories=t.concat(o)}},collapseAction(){this.collapsed=!1},handleCheckboxChanged(e,t){this.$emit(e?"select":"clear",t)},isSelected(e){return this.selected.includes(e)},resetCategories(){this.$emit("clearAll")}}}),K="_title_7aevl_5",G="_categories_7aevl_10",J="_item_7aevl_15",X="_button_7aevl_22",Y={title:K,categories:G,item:J,button:X},Z=["textContent"],x=["data-test-id"];function ee(e,t,o,r,g,b){const f=l("n8n-loading"),C=l("el-checkbox"),w=l("n8n-text");return n(),h("div",{class:s([e.$style.filters,"template-filters"]),"data-test-id":"templates-filter-container"},[i("div",{class:s(e.$style.title),textContent:p(e.$locale.baseText("templates.categoriesHeading"))},null,10,Z),e.loading?(n(),h("div",{key:0,class:s(e.$style.list)},[a(f,{loading:e.loading,rows:e.expandLimit},null,8,["loading","rows"])],2)):u("",!0),e.loading?u("",!0):(n(),h("ul",{key:1,class:s(e.$style.categories)},[i("li",{class:s(e.$style.item),"data-test-id":"template-filter-all-categories"},[a(C,{"model-value":e.allSelected,"onUpdate:modelValue":t[0]||(t[0]=()=>e.resetCategories())},{default:c(()=>[m(p(e.$locale.baseText("templates.allCategories")),1)]),_:1},8,["model-value"])],2),(n(!0),h(P,null,A(e.collapsed?e.sortedCategories.slice(0,e.expandLimit):e.sortedCategories,(d,y)=>(n(),h("li",{key:y,class:s(e.$style.item),"data-test-id":`template-filter-${d.name.toLowerCase().replaceAll(" ","-")}`},[a(C,{"model-value":e.isSelected(d),"onUpdate:modelValue":k=>e.handleCheckboxChanged(k,d)},{default:c(()=>[m(p(d.name),1)]),_:2},1032,["model-value","onUpdate:modelValue"])],10,x))),128))],2)),e.sortedCategories.length>e.expandLimit&&e.collapsed&&!e.loading?(n(),h("div",{key:2,class:s(e.$style.button),"data-test-id":"expand-categories-button",onClick:t[1]||(t[1]=(...d)=>e.collapseAction&&e.collapseAction(...d))},[a(w,{size:"small",color:"primary"},{default:c(()=>[m(" + "+p(`${e.sortedCategories.length-e.expandLimit} more`),1)]),_:1})],2)):u("",!0)],2)}const te={$style:Y},oe=_(D,[["render",ee],["__cssModules",te]]),se=v({name:"TemplatesSearchView",components:{TemplatesInfoCarousel:M,TemplateFilters:oe,TemplateList:j,TemplatesView:N},setup(){const{callDebounced:e}=I();return{callDebounced:e,...q()}},data(){return{areCategoriesPrepopulated:!1,categories:[],loading:!0,loadingCategories:!0,loadingCollections:!0,loadingWorkflows:!0,search:"",searchEventToTrack:null,errorLoadingWorkflows:!1,creatorHubUrl:B}},computed:{...S(H,$,z,R,F),totalWorkflows(){return this.templatesStore.getSearchedWorkflowsTotal(this.createQueryObject("name"))},workflows(){return this.templatesStore.getSearchedWorkflows(this.createQueryObject("name"))??[]},collections(){return this.templatesStore.getSearchedCollections(this.createQueryObject("id"))??[]},endOfSearchMessage(){return this.loadingWorkflows?null:!this.loadingCollections&&this.workflows.length===0&&this.collections.length===0?!this.settingsStore.isTemplatesEndpointReachable&&this.errorLoadingWorkflows?this.$locale.baseText("templates.connectionWarning"):this.$locale.baseText("templates.noSearchResults"):null},nothingFound(){return!this.loadingWorkflows&&!this.loadingCollections&&this.workflows.length===0&&this.collections.length===0}},watch:{workflows(e){e.length===0&&this.scrollTo(0)}},async mounted(){Q("n8n - Templates"),await this.loadCategories(),this.loadWorkflowsAndCollections(!0),this.usersStore.showPersonalizationSurvey(),this.restoreSearchFromRoute(),setTimeout(()=>{this.$route.meta&&this.$route.meta.scrollOffset>0&&this.scrollTo(this.$route.meta.scrollOffset,"auto")},100)},methods:{createQueryObject(e){return{categories:this.categories.map(t=>e==="name"?t.name:String(t.id)),search:this.search}},restoreSearchFromRoute(){let e=!1;if(this.$route.query.search&&typeof this.$route.query.search=="string"&&(this.search=this.$route.query.search,e=!0),typeof this.$route.query.categories=="string"&&this.$route.query.categories.length){const t=this.$route.query.categories.split(",");this.categories=this.templatesStore.allCategories.filter(o=>t.includes(o.id.toString())),e=!0}e&&(this.updateSearch(),this.trackCategories(),this.areCategoriesPrepopulated=!0)},onOpenCollection({event:e,id:t}){this.navigateTo(e,T.COLLECTION,t)},onOpenTemplate({event:e,id:t}){this.navigateTo(e,T.TEMPLATE,t)},navigateTo(e,t,o){if(e.metaKey||e.ctrlKey){const r=this.$router.resolve({name:t,params:{id:o}});window.open(r.href,"_blank");return}else this.$router.push({name:t,params:{id:o}})},updateSearch(){this.updateQueryParam(this.search,this.categories.map(e=>e.id).join(",")),this.loadWorkflowsAndCollections(!1)},updateSearchTracking(e,t){e&&(this.searchEventToTrack&&this.searchEventToTrack.search_string.length>e.length||(this.searchEventToTrack={search_string:e,workflow_results_count:this.workflows.length,collection_results_count:this.collections.length,categories_applied:t.map(o=>this.templatesStore.getCategoryById(o.toString())),wf_template_repo_session_id:this.templatesStore.currentSessionId}))},trackSearch(){this.searchEventToTrack&&(this.$telemetry.track("User searched workflow templates",this.searchEventToTrack),this.searchEventToTrack=null)},onSearchInput(e){this.loadingWorkflows=!0,this.loadingCollections=!0,this.search=e,this.callDebounced(this.updateSearch,{debounceTime:500,trailing:!0}),e.length===0&&this.trackSearch()},onCategorySelected(e){this.categories=this.categories.concat(e),this.updateSearch(),this.trackCategories()},onCategoryUnselected(e){this.categories=this.categories.filter(t=>t.id!==e.id),this.updateSearch(),this.trackCategories()},onCategoriesCleared(){this.categories=[],this.updateSearch()},trackCategories(){this.categories.length&&this.$telemetry.track("User changed template filters",{search_string:this.search,categories_applied:this.categories,wf_template_repo_session_id:this.templatesStore.currentSessionId})},updateQueryParam(e,t){const o=Object.assign({},this.$route.query);t.length?o.categories=t:delete o.categories,e.length?o.search=e:delete o.search,this.$router.replace({query:o})},async onLoadMore(){if(!(this.workflows.length>=this.totalWorkflows))try{this.loadingWorkflows=!0,await this.templatesStore.getMoreWorkflows({categories:this.categories.map(e=>e.name),search:this.search})}catch{this.showMessage({title:"Error",message:"Could not load more workflows",type:"error"})}finally{this.loadingWorkflows=!1}},async loadCategories(){try{await this.templatesStore.getCategories()}catch{}this.loadingCategories=!1},async loadCollections(){try{this.loadingCollections=!0,await this.templatesStore.getCollections({categories:this.categories.map(e=>String(e.id)),search:this.search})}catch{}this.loadingCollections=!1},async loadWorkflows(){try{this.loadingWorkflows=!0,await this.templatesStore.getWorkflows({search:this.search,categories:this.categories.map(e=>e.name)}),this.errorLoadingWorkflows=!1}catch{this.errorLoadingWorkflows=!0}this.loadingWorkflows=!1},async loadWorkflowsAndCollections(e){const t=this.search,o=[...this.categories];await Promise.all([this.loadWorkflows(),this.loadCollections()]),e||this.updateSearchTracking(t,o.map(r=>r.id))},scrollTo(e,t="smooth"){setTimeout(()=>{const o=document.getElementById("content");o&&o.scrollTo({top:e,behavior:t})},0)}},beforeRouteLeave(e,t,o){var g;const r=document.getElementById("content");r&&(g=this.$route.meta)!=null&&g.setScrollPosition&&typeof this.$route.meta.setScrollPosition=="function"&&this.$route.meta.setScrollPosition(r.scrollTop),this.trackSearch(),o()}}),ae="_wrapper_p3frq_5",re="_contentWrapper_p3frq_10",le="_filters_p3frq_20",ie="_search_p3frq_26",ne="_header_p3frq_38",ce={wrapper:ae,contentWrapper:re,filters:le,search:ie,header:ne},de=["textContent"],he=["innerHTML"];function pe(e,t,o,r,g,b){const f=l("n8n-heading"),C=l("n8n-button"),w=l("TemplateFilters"),d=l("font-awesome-icon"),y=l("n8n-input"),k=l("TemplatesInfoCarousel"),W=l("TemplateList"),L=l("n8n-text"),O=l("TemplatesView");return n(),E(O,null,{header:c(()=>[i("div",{class:s(e.$style.wrapper)},[i("div",{class:s(e.$style.title)},[a(f,{tag:"h1",size:"2xlarge"},{default:c(()=>[m(p(e.$locale.baseText("templates.heading")),1)]),_:1})],2),i("div",{class:s(e.$style.button)},[a(C,{size:"large",type:"secondary",element:"a",href:e.creatorHubUrl,label:e.$locale.baseText("templates.shareWorkflow"),target:"_blank"},null,8,["href","label"])],2)],2)]),content:c(()=>[i("div",{class:s(e.$style.contentWrapper)},[i("div",{class:s(e.$style.filters)},[a(w,{categories:e.templatesStore.allCategories,"sort-on-populate":e.areCategoriesPrepopulated,selected:e.categories,loading:e.loadingCategories,onClear:e.onCategoryUnselected,onClearAll:e.onCategoriesCleared,onSelect:e.onCategorySelected},null,8,["categories","sort-on-populate","selected","loading","onClear","onClearAll","onSelect"])],2),i("div",{class:s(e.$style.search)},[a(y,{"model-value":e.search,placeholder:e.$locale.baseText("templates.searchPlaceholder"),clearable:"","data-test-id":"template-search-input","onUpdate:modelValue":e.onSearchInput,onBlur:e.trackSearch},{prefix:c(()=>[a(d,{icon:"search"})]),_:1},8,["model-value","placeholder","onUpdate:modelValue","onBlur"]),U(i("div",{class:s(e.$style.carouselContainer)},[i("div",{class:s(e.$style.header)},[a(f,{bold:!0,size:"medium",color:"text-light"},{default:c(()=>[m(p(e.$locale.baseText("templates.collections"))+" ",1),e.loadingCollections?u("",!0):(n(),h("span",{key:0,"data-test-id":"collection-count-label",textContent:p(`(${e.collections.length})`)},null,8,de))]),_:1})],2),a(k,{collections:e.collections,loading:e.loadingCollections,onOpenCollection:e.onOpenCollection},null,8,["collections","loading","onOpenCollection"])],2),[[V,e.collections.length||e.loadingCollections]]),a(W,{"infinite-scroll-enabled":!0,loading:e.loadingWorkflows,workflows:e.workflows,"total-count":e.totalWorkflows,onLoadMore:e.onLoadMore,onOpenTemplate:e.onOpenTemplate},null,8,["loading","workflows","total-count","onLoadMore","onOpenTemplate"]),e.endOfSearchMessage?(n(),h("div",{key:0,class:s(e.$style.endText)},[a(L,{size:"medium",color:"text-base"},{default:c(()=>[i("span",{innerHTML:e.endOfSearchMessage},null,8,he)]),_:1})],2)):u("",!0)],2)],2)]),_:1})}const ue={$style:ce},Ke=_(se,[["render",pe],["__cssModules",ue]]);export{Ke as default};
//# sourceMappingURL=TemplatesSearchView-Mk4O5J11.js.map
