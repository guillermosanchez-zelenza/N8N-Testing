import{m as D}from"./pinia-aUqqC48i.js";import{p as U}from"./pushConnection-PNUo6dZ9.js";import{e3 as re,_ as v,k as O,aM as le,e4 as F,e5 as A,e6 as P,e7 as V,j as de,u as R,f as G,v as j,e8 as ue,cQ as ce,e as he,br as pe,t as K,l as me,m as fe,$ as N,V as u,Y as we,e9 as b,h as be,df as ve,dg as H,a6 as ke,d2 as Ee,dv as ge,dI as Te,M as g,a9 as $e,q as _e}from"./n8n-_nNvRoCf.js";import{G as k,l as r,m,H as B,ag as i,M as _,O as p,p as E,a7 as Se,F as We,J as ye,I as w,R as I,S as C,T as d,aq as Ie,V as Y,a8 as X,a2 as Oe,r as Be,e as z,b as Ne,y as Ce,Q as M,U as Me}from"./vendor-NNwioulI.js";import{u as x,S as De,T as Re,w as L,a as Le,b as Ue,c as q,d as Fe}from"./index-xP-VuMjv.js";import{d as Ae}from"./lodash-es-5z_C16pm.js";import{P as Pe}from"./PushConnectionTracker-tj_z_KlE.js";import{W as Ve}from"./WorkflowActivator-cWuKXdhv.js";import{u as Ke}from"./collaboration.store-emJMSzVB.js";import{F as He}from"./file-saver-GLtlGJrO.js";import"./flatted-jPn12Tq4.js";import"./axios-s2RMMPhA.js";import"./esprima-next-ulPLCZ1Z.js";import"./luxon-ZRIU05qF.js";import"./@vueuse/core-8g26_cc0.js";import"./uuid-McvpxQtQ.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";import"./workflowActivate-taS2Qpdq.js";const Xe=25,ze=4,Ge=k({name:"ShortenName",props:["name","limit","testId"],computed:{shortenedName(){return re(this.name,this.limit||Xe,ze)}}}),je=["title","data-test-id"];function Ye(e,t,s,o,a,n){return r(),m("span",{title:e.name,"data-test-id":e.testId},[B(e.$slots,"default",{shortenedName:e.shortenedName})],8,je)}const xe=v(Ge,[["render",Ye]]),qe=k({name:"IntersectionObserver",props:{threshold:{type:Number,default:0},enabled:{type:Boolean,default:!1},eventBus:{type:Object,default:()=>O()}},data(){return{observer:null}},mounted(){if(!this.enabled)return;const e={root:this.$refs.root,rootMargin:"0px",threshold:this.threshold},t=new IntersectionObserver(s=>{s.forEach(({target:o,isIntersecting:a})=>{this.$emit("observed",{el:o,isIntersecting:a})})},e);this.observer=t,this.eventBus.on("observe",s=>{s&&t.observe(s)}),this.eventBus.on("unobserve",s=>{t.unobserve(s)})},beforeUnmount(){this.enabled&&this.observer.disconnect()}}),Je={ref:"root"};function Qe(e,t,s,o,a,n){return r(),m("div",Je,[B(e.$slots,"default")],512)}const Ze=v(qe,[["render",Qe]]),et=k({name:"IntersectionObserved",props:{enabled:{type:Boolean,default:!1},eventBus:{type:Object,default:()=>O()}},async mounted(){this.enabled&&(await this.$nextTick(),this.eventBus.emit("observe",this.$refs.observed))},beforeUnmount(){this.enabled&&this.eventBus.emit("unobserve",this.$refs.observed)}}),tt={ref:"observed"};function st(e,t,s,o,a,n){return r(),m("span",tt,[B(e.$slots,"default")],512)}const ot=v(et,[["render",st]]),at=20,nt=k({name:"TagsContainer",components:{IntersectionObserver:Ze,IntersectionObserved:ot},props:["tagIds","limit","clickable","responsive","hoverable"],data(){return{maxWidth:320,intersectionEventBus:O(),visibility:{},debouncedSetMaxWidth:()=>{}}},created(){this.debouncedSetMaxWidth=Ae(this.setMaxWidth,100)},mounted(){this.setMaxWidth(),window.addEventListener("resize",this.debouncedSetMaxWidth)},beforeUnmount(){window.removeEventListener("resize",this.debouncedSetMaxWidth)},computed:{...D(x),style(){return{"max-width":`${this.maxWidth}px`}},tags(){const e=this.tagIds.map(a=>this.tagsStore.getTagById(a)).filter(Boolean),t=this.limit||at;let s=t?e.slice(0,t):e;s=s.map(a=>({...a,hidden:this.responsive&&!this.visibility[a.id]}));let o=s.length;if(this.responsive&&(o=Object.values(this.visibility).reduce((a,n)=>n?a+1:a,0)),o<e.length){const a=e.slice(o),n=a.reduce((f,c)=>f?`${f}, ${c.name}`:c.name,""),l={id:"count",name:`+${a.length}`,title:n,isCount:!0};s.splice(o,0,l)}return s}},methods:{setMaxWidth(){const t=this.$refs.tagsContainer.$el.parentNode;t&&(this.maxWidth=0,this.$nextTick(()=>{this.maxWidth=t.clientWidth}))},onObserved({el:e,isIntersecting:t}){e.dataset.id&&(this.visibility={...this.visibility,[e.dataset.id]:t})},onClick(e,t){this.clickable&&e.stopPropagation(),t.hidden||this.$emit("click",t.id)}}}),it={class:"tags"},rt=["onClick"];function lt(e,t,s,o,a,n){const l=i("el-tag"),f=i("IntersectionObserved"),c=i("IntersectionObserver");return r(),_(c,{ref:"tagsContainer",threshold:1,class:"tags-container",style:ye(e.style),enabled:e.responsive,"event-bus":e.intersectionEventBus,onObserved:e.onObserved},{default:p(()=>[E("span",it,[(r(!0),m(We,null,Se(e.tags,h=>(r(),m("span",{key:h.id,class:w({clickable:!h.hidden}),onClick:W=>e.onClick(W,h)},[h.isCount?(r(),_(l,{key:0,title:h.title,type:"info",size:"small",class:"count-container","disable-transitions":!0},{default:p(()=>[C(I(h.name),1)]),_:2},1032,["title"])):(r(),_(f,{key:1,class:w({hidden:h.hidden}),"data-id":h.id,enabled:e.responsive,"event-bus":e.intersectionEventBus},{default:p(()=>[d(l,{title:h.name,type:"info",size:"small",class:w({hoverable:e.hoverable}),"disable-transitions":!0},{default:p(()=>[C(I(h.name),1)]),_:2},1032,["title","class"])]),_:2},1032,["class","data-id","enabled","event-bus"]))],10,rt))),128))])]),_:1},8,["style","enabled","event-bus","onObserved"])}const dt=v(nt,[["render",lt],["__scopeId","data-v-3d3ad0a0"]]),ut=k({name:"ExpandableInputBase",props:["modelValue","placeholder","staticSize"],computed:{hiddenValue(){let e=this.modelValue.replace(/\s/g,".");return e||(e=this.placeholder),`${e}`}}}),ct=["data-value"];function ht(e,t,s,o,a,n){return r(),m("div",{class:w({"el-input":!0,"static-size":e.staticSize}),"data-value":e.hiddenValue},[B(e.$slots,"default",{},void 0,!0)],10,ct)}const J=v(ut,[["render",ht],["__scopeId","data-v-e0207138"]]),pt=k({name:"ExpandableInputEdit",components:{ExpandableInputBase:J},props:{modelValue:{},placeholder:{},maxlength:{},autofocus:{},eventBus:{type:Object}},mounted(){var e;this.autofocus&&this.$refs.input&&this.focus(),(e=this.eventBus)==null||e.on("focus",this.focus)},beforeUnmount(){var e;(e=this.eventBus)==null||e.off("focus",this.focus)},methods:{focus(){this.$refs.input&&this.$refs.input.focus()},onInput(){this.$emit("update:modelValue",this.$refs.input.value)},onEnter(){this.$emit("enter",this.$refs.input.value)},onClickOutside(e){e.type==="click"&&this.$emit("blur",this.$refs.input.value)},onEscape(){this.$emit("esc")}}}),mt=["value","placeholder","maxlength"];function ft(e,t,s,o,a,n){const l=i("ExpandableInputBase"),f=Ie("on-click-outside");return r(),_(l,{"model-value":e.modelValue,placeholder:e.placeholder},{default:p(()=>[Y(E("input",{ref:"input",class:"el-input__inner",value:e.modelValue,placeholder:e.placeholder,maxlength:e.maxlength,size:"4",onInput:t[0]||(t[0]=(...c)=>e.onInput&&e.onInput(...c)),onKeydown:[t[1]||(t[1]=X((...c)=>e.onEnter&&e.onEnter(...c),["enter"])),t[2]||(t[2]=X((...c)=>e.onEscape&&e.onEscape(...c),["esc"]))]},null,40,mt),[[f,e.onClickOutside]])]),_:1},8,["model-value","placeholder"])}const wt=v(pt,[["render",ft]]),bt=k({name:"ExpandableInputPreview",components:{ExpandableInputBase:J},props:["modelValue"]}),vt=["value"];function kt(e,t,s,o,a,n){const l=i("ExpandableInputBase");return r(),_(l,{"model-value":e.modelValue,"static-size":!0},{default:p(()=>[E("input",{class:w({"el-input__inner":!0,clickable:!0}),value:e.modelValue,disabled:!0,size:"4"},null,8,vt)]),_:1},8,["model-value"])}const Et=v(bt,[["render",kt],["__scopeId","data-v-2b5f366c"]]),gt=k({name:"InlineTextEdit",components:{ExpandableInputEdit:wt,ExpandableInputPreview:Et},props:{isEditEnabled:{type:Boolean,default:!1},modelValue:{type:String,default:""},placeholder:{type:String,default:""},maxLength:{type:Number,default:0},previewValue:{type:String,default:""},disabled:{type:Boolean,default:!1}},data(){return{isDisabled:this.disabled,newValue:"",escPressed:!1,inputBus:O()}},watch:{disabled(e){this.isDisabled=e}},methods:{onInput(e){this.disabled||(this.newValue=e)},onClick(){this.disabled||(this.newValue=this.modelValue,this.$emit("toggle"))},onBlur(){this.disabled||(this.escPressed||this.submit(),this.escPressed=!1)},submit(){if(this.disabled)return;const e=t=>{this.isDisabled=!1,t||this.inputBus.emit("focus")};this.isDisabled=!0,this.$emit("submit",{name:this.newValue,onSubmit:e})},onEscape(){this.disabled||(this.escPressed=!0,this.$emit("toggle"))}}}),Tt={key:0};function $t(e,t,s,o,a,n){const l=i("ExpandableInputEdit"),f=i("ExpandableInputPreview");return r(),m("span",{class:"inline-edit",onKeydown:t[1]||(t[1]=Oe(()=>{},["stop"]))},[e.isEditEnabled&&!e.isDisabled?(r(),m("span",Tt,[d(l,{placeholder:e.placeholder,"model-value":e.newValue,maxlength:e.maxLength,autofocus:!0,"event-bus":e.inputBus,"onUpdate:modelValue":e.onInput,onEsc:e.onEscape,onBlur:e.onBlur,onEnter:e.submit},null,8,["placeholder","model-value","maxlength","event-bus","onUpdate:modelValue","onEsc","onBlur","onEnter"])])):(r(),m("span",{key:1,class:"preview",onClick:t[0]||(t[0]=(...c)=>e.onClick&&e.onClick(...c))},[d(f,{"model-value":e.previewValue||e.modelValue},null,8,["model-value"])]))],32)}const _t=v(gt,[["render",$t],["__scopeId","data-v-4200a9e8"]]),St=k({name:"BreakpointsObserver",props:["valueXS","valueXL","valueLG","valueMD","valueSM","valueDefault"],setup(){const{callDebounced:e}=le();return{callDebounced:e}},data(){return{width:window.innerWidth}},computed:{bp(){return this.width<F?"XS":this.width>=A?"XL":this.width>=P?"LG":this.width>=V?"MD":"SM"},value(){return this.valueXS!==void 0&&this.width<F?this.valueXS:this.valueXL!==void 0&&this.width>=A?this.valueXL:this.valueLG!==void 0&&this.width>=P?this.valueLG:this.valueMD!==void 0&&this.width>=V?this.valueMD:this.valueSM!==void 0?this.valueSM:this.valueDefault}},created(){window.addEventListener("resize",this.onResize)},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{onResize(){this.callDebounced(this.onResizeEnd,{debounceTime:50})},async onResizeEnd(){this.width=window.innerWidth,await this.$nextTick();const e=await de();R().updateBannersHeight(e)}}});function Wt(e,t,s,o,a,n){return r(),m("span",null,[B(e.$slots,"default",{bp:e.bp,value:e.value})])}const yt=v(St,[["render",Wt]]),It=k({__name:"CollaborationPane",setup(e){const t=Ke(),s=G(),o=j(),a=5*ue.MINUTE,n=Be(null),l=z(()=>{const T=(t.getUsersForCurrentWorkflow??[]).map($=>$.user),y=T.find($=>$.role==="global:owner");return{defaultGroup:y?[y,...T.filter($=>$.id!==y.id)]:T}}),f=z(()=>{var T;return(T=s.currentUser)==null?void 0:T.email}),c=()=>{n.value!==null&&(clearInterval(n.value),n.value=null),n.value=window.setInterval(()=>{t.notifyWorkflowOpened(o.workflow.id)},a)},h=()=>{n.value!==null&&clearInterval(n.value)},W=()=>{document.visibilityState==="hidden"?h():c()};return Ne(()=>{c(),document.addEventListener("visibilitychange",W)}),Ce(()=>{document.removeEventListener("visibilitychange",W),h()}),(T,y)=>{const $=i("n8n-user-stack");return r(),m("div",{class:w(`collaboration-pane-container ${T.$style.container}`),"data-test-id":"collaboration-pane"},[d($,{users:l.value,"current-user-email":f.value},null,8,["users","current-user-email"])],2)}}}),Ot="_container_1f63u_5",Bt={container:Ot},Nt={$style:Bt},Ct=v(It,[["__cssModules",Nt]]),Mt=(e,t)=>{if(e.length!==t.length)return!0;const s=new Set(e);return t.reduce((o,a)=>o||!s.has(a),!1)},Dt=k({name:"WorkflowDetails",components:{TagsContainer:dt,PushConnectionTracker:Pe,ShortenName:xe,WorkflowActivator:Ve,SaveButton:De,TagsDropdown:Re,InlineTextEdit:_t,BreakpointsObserver:yt,CollaborationPane:Ct},mixins:[L],props:{readOnly:{type:Boolean,default:!1}},setup(){return{...ce(),...he(),...Le()}},data(){return{isTagsEditEnabled:!1,isNameEditEnabled:!1,appliedTagIds:[],tagsEditBus:O(),MAX_WORKFLOW_NAME_LENGTH:pe,tagsSaving:!1,eventBus:O(),EnterpriseEditionFeature:K}},computed:{...D(x,fe,me,R,Fe,j,G,q,Ue),currentUser(){return this.usersStore.currentUser},contextBasedTranslationKeys(){return this.uiStore.contextBasedTranslationKeys},isWorkflowActive(){return this.workflowsStore.isWorkflowActive},workflowName(){return this.workflowsStore.workflowName},isDirty(){return this.uiStore.stateIsDirty},readOnlyEnv(){return this.sourceControlStore.preferences.branchReadOnly},currentWorkflowTagIds(){return this.workflowsStore.workflowTags},isNewWorkflow(){return!this.currentWorkflowId||this.currentWorkflowId===N||this.currentWorkflowId==="new"},isWorkflowSaving(){return this.uiStore.isActionActive("workflowSaving")},workflow(){return this.workflowsStore.workflow},currentWorkflowId(){return this.workflowsStore.workflowId},onWorkflowPage(){return this.$route.meta&&(this.$route.meta.nodeView||this.$route.meta.keepWorkflowAlive===!0)},onExecutionsTab(){return[u.EXECUTION_HOME.toString(),u.WORKFLOW_EXECUTIONS.toString(),u.EXECUTION_PREVIEW].includes(this.$route.name||"")},workflowPermissions(){return we(this.currentUser,this.workflow)},workflowMenuItems(){const e=[{id:b.DOWNLOAD,label:this.$locale.baseText("menuActions.download"),disabled:!this.onWorkflowPage}];return this.readOnly||(e.unshift({id:b.DUPLICATE,label:this.$locale.baseText("menuActions.duplicate"),disabled:!this.onWorkflowPage||!this.currentWorkflowId}),e.push({id:b.IMPORT_FROM_URL,label:this.$locale.baseText("menuActions.importFromUrl"),disabled:!this.onWorkflowPage||this.onExecutionsTab},{id:b.IMPORT_FROM_FILE,label:this.$locale.baseText("menuActions.importFromFile"),disabled:!this.onWorkflowPage||this.onExecutionsTab})),be(["rbac"],{rbac:{scope:"sourceControl:push"}})&&e.push({id:b.PUSH,label:this.$locale.baseText("menuActions.push"),disabled:!this.sourceControlStore.isEnterpriseSourceControlEnabled||!this.onWorkflowPage||this.onExecutionsTab||this.readOnlyEnv}),e.push({id:b.SETTINGS,label:this.$locale.baseText("generic.settings"),disabled:!this.onWorkflowPage||this.isNewWorkflow}),this.workflowPermissions.delete&&!this.readOnly&&e.push({id:b.DELETE,label:this.$locale.baseText("menuActions.delete"),disabled:!this.onWorkflowPage||this.isNewWorkflow,customClass:this.$style.deleteItem,divided:!0}),e},isWorkflowHistoryFeatureEnabled(){return this.settingsStore.isEnterpriseFeatureEnabled(K.WorkflowHistory)},workflowHistoryRoute(){return{name:u.WORKFLOW_HISTORY,params:{workflowId:this.currentWorkflowId}}},isWorkflowHistoryButtonDisabled(){return this.workflowsStore.isNewWorkflow}},watch:{currentWorkflowId(){this.isTagsEditEnabled=!1,this.isNameEditEnabled=!1}},methods:{async onSaveButtonClick(){let e;this.currentWorkflowId!==N?e=this.currentWorkflowId:this.$route.params.name&&this.$route.params.name!=="new"&&(e=this.$route.params.name),await this.saveCurrentWorkflow({id:e,name:this.workflowName,tags:this.currentWorkflowTagIds})&&(await this.settingsStore.fetchPromptsData(),this.$route.name===u.EXECUTION_DEBUG&&await this.$router.replace({name:u.WORKFLOW,params:{name:this.currentWorkflowId}}))},onShareButtonClick(){var e;this.uiStore.openModalWithData({name:ve,data:{id:this.currentWorkflowId}}),this.$telemetry.track("User opened sharing modal",{workflow_id:this.currentWorkflowId,user_id_sharer:(e=this.currentUser)==null?void 0:e.id,sub_view:this.$route.name===u.WORKFLOWS?"Workflows listing":"Workflow editor"})},onTagsEditEnable(){this.appliedTagIds=this.currentWorkflowTagIds,this.isTagsEditEnabled=!0,setTimeout(()=>{this.isNameEditEnabled=!1,this.tagsEditBus.emit("focus")},0)},async onTagsBlur(){const e=this.currentWorkflowTagIds,t=this.appliedTagIds;if(!Mt(e,t)){this.isTagsEditEnabled=!1;return}if(this.tagsSaving)return;this.tagsSaving=!0;const s=await this.saveCurrentWorkflow({tags:t});this.$telemetry.track("User edited workflow tags",{workflow_id:this.currentWorkflowId,new_tag_count:t.length}),this.tagsSaving=!1,s&&(this.isTagsEditEnabled=!1)},onTagsEditEsc(){this.isTagsEditEnabled=!1},onNameToggle(){this.isNameEditEnabled=!this.isNameEditEnabled,this.isNameEditEnabled&&(this.isTagsEditEnabled&&this.onTagsBlur(),this.isTagsEditEnabled=!1)},async onNameSubmit({name:e,onSubmit:t}){const s=e.trim();if(!s){this.showMessage({title:this.$locale.baseText("workflowDetails.showMessage.title"),message:this.$locale.baseText("workflowDetails.showMessage.message"),type:"error"}),t(!1);return}if(s===this.workflowName){this.isNameEditEnabled=!1,t(!0);return}const o=await this.saveCurrentWorkflow({name:e});o&&(this.isNameEditEnabled=!1),t(o)},async handleFileImport(){const e=this.$refs.importFile;if(e!=null&&e.files&&e.files.length!==0){const t=new FileReader;t.onload=()=>{let s;try{s=JSON.parse(t.result)}catch{this.showMessage({title:this.$locale.baseText("mainSidebar.showMessage.handleFileImport.title"),message:this.$locale.baseText("mainSidebar.showMessage.handleFileImport.message"),type:"error"});return}finally{t.onload=void 0,e.value=null}H.emit("importWorkflowData",{data:s})},t.readAsText(e.files[0])}},async onWorkflowMenuSelect(e){switch(e){case b.DUPLICATE:{this.uiStore.openModalWithData({name:Te,data:{id:this.workflowsStore.workflowId,name:this.workflowsStore.workflowName,tags:this.workflowsStore.workflowTags}});break}case b.DOWNLOAD:{const t=await this.getWorkflowDataToSave(),{tags:s,...o}=t,a={...o,meta:{...this.workflowsStore.workflow.meta||{},instanceId:this.rootStore.instanceId},tags:(s||[]).map(f=>{const{usageCount:c,...h}=this.tagsStore.getTagById(f);return h})},n=new Blob([JSON.stringify(a,null,2)],{type:"application/json;charset=utf-8"});let l=this.workflowName||"unsaved_workflow";l=l.replace(/[^a-z0-9]/gi,"_"),this.$telemetry.track("User exported workflow",{workflow_id:t.id}),He.saveAs(n,l+".json");break}case b.IMPORT_FROM_URL:{try{const t=await this.prompt(this.$locale.baseText("mainSidebar.prompt.workflowUrl")+":",this.$locale.baseText("mainSidebar.prompt.importWorkflowFromUrl")+":",{confirmButtonText:this.$locale.baseText("mainSidebar.prompt.import"),cancelButtonText:this.$locale.baseText("mainSidebar.prompt.cancel"),inputErrorMessage:this.$locale.baseText("mainSidebar.prompt.invalidUrl"),inputPattern:/^http[s]?:\/\/.*\.json$/i});H.emit("importWorkflowUrl",{url:t.value})}catch{}break}case b.IMPORT_FROM_FILE:{this.$refs.importFile.click();break}case b.PUSH:{this.canvasStore.startLoading();try{await this.onSaveButtonClick();const t=await this.sourceControlStore.getAggregatedStatus();this.uiStore.openModalWithData({name:ge,data:{eventBus:this.eventBus,status:t}})}catch(t){switch(t.message){case"source_control_not_connected":this.showError({...t,message:""},this.$locale.baseText("settings.sourceControl.error.not.connected.title"),this.$locale.baseText("settings.sourceControl.error.not.connected.message"));break;default:this.showError(t,this.$locale.baseText("error"))}}finally{this.canvasStore.stopLoading()}break}case b.SETTINGS:{this.uiStore.openModal(Ee);break}case b.DELETE:{if(await this.confirm(this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.message",{interpolate:{workflowName:this.workflowName}}),this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.headline"),{type:"warning",confirmButtonText:this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.confirmButtonText"),cancelButtonText:this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.cancelButtonText")})!==ke)return;try{await this.workflowsStore.deleteWorkflow(this.currentWorkflowId)}catch(s){this.showError(s,this.$locale.baseText("generic.deleteWorkflowError"));return}this.uiStore.stateIsDirty=!1,this.titleReset(),this.showMessage({title:this.$locale.baseText("mainSidebar.showMessage.handleSelect1.title"),type:"success"}),await this.$router.push({name:u.NEW_WORKFLOW});break}}},goToUpgrade(){this.uiStore.goToUpgrade("workflow_sharing","upgrade-workflow-sharing")}}}),Rt="_group_1693j_5",Lt="_hiddenInput_1693j_10",Ut="_deleteItem_1693j_14",Ft="_disabledShareButton_1693j_18",At="_workflowHistoryButton_1693j_22",Pt={group:Rt,hiddenInput:Lt,deleteItem:Ut,disabledShareButton:Ft,workflowHistoryButton:At},Vt={key:0,class:"container"},Kt={key:0,class:"tags","data-test-id":"workflow-tags-container"},Ht={key:1},Xt={key:1,class:"tags"};function zt(e,t,s,o,a,n){const l=i("InlineTextEdit"),f=i("ShortenName"),c=i("BreakpointsObserver"),h=i("TagsDropdown"),W=i("TagsContainer"),T=i("WorkflowActivator"),y=i("CollaborationPane"),$=i("n8n-button"),Q=i("i18n-t"),Z=i("n8n-tooltip"),ee=i("enterprise-edition"),te=i("SaveButton"),se=i("n8n-icon-button"),oe=i("router-link"),ae=i("n8n-action-dropdown"),ne=i("PushConnectionTracker");return e.workflowName?(r(),m("div",Vt,[d(c,{"value-x-s":15,"value-s-m":25,"value-m-d":50,class:"name-container"},{default:p(({value:S})=>[d(f,{name:e.workflowName,limit:S,custom:!0,"test-id":"workflow-name-input"},{default:p(({shortenedName:ie})=>[d(l,{"model-value":e.workflowName,"preview-value":ie,"is-edit-enabled":e.isNameEditEnabled,"max-length":e.MAX_WORKFLOW_NAME_LENGTH,disabled:e.readOnly,placeholder:"Enter workflow name",class:"name",onToggle:e.onNameToggle,onSubmit:e.onNameSubmit},null,8,["model-value","preview-value","is-edit-enabled","max-length","disabled","onToggle","onSubmit"])]),_:2},1032,["name","limit"])]),_:1}),e.settingsStore.areTagsEnabled?(r(),m("span",Kt,[e.isTagsEditEnabled&&!e.readOnly?(r(),_(h,{key:0,ref:"dropdown",modelValue:e.appliedTagIds,"onUpdate:modelValue":t[0]||(t[0]=S=>e.appliedTagIds=S),"create-enabled":!0,"event-bus":e.tagsEditBus,placeholder:e.$locale.baseText("workflowDetails.chooseOrCreateATag"),class:"tags-edit","data-test-id":"workflow-tags-dropdown",onBlur:e.onTagsBlur,onEsc:e.onTagsEditEsc},null,8,["modelValue","event-bus","placeholder","onBlur","onEsc"])):e.currentWorkflowTagIds.length===0&&!e.readOnly?(r(),m("div",Ht,[E("span",{class:"add-tag clickable","data-test-id":"new-tag-link",onClick:t[1]||(t[1]=(...S)=>e.onTagsEditEnable&&e.onTagsEditEnable(...S))}," + "+I(e.$locale.baseText("workflowDetails.addTag")),1)])):(r(),_(W,{key:e.currentWorkflowId,"tag-ids":e.currentWorkflowTagIds,clickable:!0,responsive:!0,"data-test-id":"workflow-tags",onClick:e.onTagsEditEnable},null,8,["tag-ids","onClick"]))])):(r(),m("span",Xt)),d(ne,{class:"actions"},{default:p(()=>[E("span",{class:w(`activator ${e.$style.group}`)},[d(T,{"workflow-active":e.isWorkflowActive,"workflow-id":e.currentWorkflowId},null,8,["workflow-active","workflow-id"])],2),d(ee,{features:[e.EnterpriseEditionFeature.Sharing]},{fallback:p(()=>[d(Z,null,{content:p(()=>[d(Q,{keypath:e.contextBasedTranslationKeys.workflows.sharing.unavailable.description.tooltip,tag:"span"},{action:p(()=>[E("a",{onClick:t[2]||(t[2]=(...S)=>e.goToUpgrade&&e.goToUpgrade(...S))},I(e.$locale.baseText(e.contextBasedTranslationKeys.workflows.sharing.unavailable.button)),1)]),_:1},8,["keypath"])]),default:p(()=>[d($,{type:"secondary",class:w(["mr-2xs",e.$style.disabledShareButton])},{default:p(()=>[C(I(e.$locale.baseText("workflowDetails.share")),1)]),_:1},8,["class"])]),_:1})]),default:p(()=>[E("div",{class:w(e.$style.group)},[d(y),d($,{type:"secondary","data-test-id":"workflow-share-button",onClick:e.onShareButtonClick},{default:p(()=>[C(I(e.$locale.baseText("workflowDetails.share")),1)]),_:1},8,["onClick"])],2)]),_:1},8,["features"]),E("div",{class:w(e.$style.group)},[d(te,{type:"primary",saved:!e.isDirty&&!e.isNewWorkflow,disabled:e.isWorkflowSaving||e.readOnly,"data-test-id":"workflow-save-button",onClick:e.onSaveButtonClick},null,8,["saved","disabled","onClick"]),e.isWorkflowHistoryFeatureEnabled?(r(),_(oe,{key:0,to:e.workflowHistoryRoute,class:w(e.$style.workflowHistoryButton)},{default:p(()=>[d(se,{disabled:e.isWorkflowHistoryButtonDisabled,"data-test-id":"workflow-history-button",type:"tertiary",icon:"history",size:"medium",text:""},null,8,["disabled"])]),_:1},8,["to","class"])):M("",!0)],2),E("div",{class:w([e.$style.workflowMenuContainer,e.$style.group])},[E("input",{ref:"importFile",class:w(e.$style.hiddenInput),type:"file","data-test-id":"workflow-import-input",onChange:t[3]||(t[3]=S=>e.handleFileImport())},null,34),d(ae,{items:e.workflowMenuItems,"data-test-id":"workflow-menu",onSelect:e.onWorkflowMenuSelect},null,8,["items","onSelect"])],2)]),_:1})])):M("",!0)}const Gt={$style:Pt},jt=v(Dt,[["render",zt],["__cssModules",Gt],["__scopeId","data-v-9969951d"]]),Yt=k({name:"TabBar",props:{items:{type:Array,required:!0},activeTab:{type:String,default:g.WORKFLOW}},data(){return{MAIN_HEADER_TABS:g}},computed:{...D(R),mainSidebarCollapsed(){return this.uiStore.sidebarMenuCollapsed}},methods:{onSelect(e,t){this.$emit("select",e,t)}}}),xt="_container_1o2mz_5",qt={container:xt};function Jt(e,t,s,o,a,n){const l=i("n8n-radio-buttons");return e.items?(r(),m("div",{key:0,class:w({[e.$style.container]:!0,"tab-bar-container":!0,[e.$style.menuCollapsed]:e.mainSidebarCollapsed})},[d(l,{"model-value":e.activeTab,options:e.items,"onUpdate:modelValue":e.onSelect},null,8,["model-value","options","onUpdate:modelValue"])],2)):M("",!0)}const Qt={$style:qt},Zt=v(Yt,[["render",Jt],["__cssModules",Qt]]),es=k({name:"MainHeader",components:{WorkflowDetails:jt,TabBar:Zt},mixins:[U,L],setup(e,t){var s,o,a,n;return{...(o=(s=U).setup)==null?void 0:o.call(s,e,t),...(n=(a=L).setup)==null?void 0:n.call(a,e,t)}},data(){return{activeHeaderTab:g.WORKFLOW,workflowToReturnTo:"",dirtyState:!1}},computed:{...D($e,R,q),tabBarItems(){return[{value:g.WORKFLOW,label:this.$locale.baseText("generic.editor")},{value:g.EXECUTIONS,label:this.$locale.baseText("generic.executions")}]},activeNode(){return this.ndvStore.activeNode},hideMenuBar(){return!!(this.activeNode&&this.activeNode.type!==_e)},workflowName(){return this.workflowsStore.workflowName},currentWorkflow(){return this.$route.params.name||this.workflowsStore.workflowId},onWorkflowPage(){return this.$route.meta&&(this.$route.meta.nodeView||this.$route.meta.keepWorkflowAlive===!0)},activeExecution(){return this.workflowsStore.activeWorkflowExecution},readOnly(){return this.sourceControlStore.preferences.branchReadOnly}},watch:{$route(e,t){this.syncTabsWithRoute(e)}},mounted(){this.dirtyState=this.uiStore.stateIsDirty,this.syncTabsWithRoute(this.$route)},methods:{syncTabsWithRoute(e){e.name===u.EXECUTION_HOME||e.name===u.WORKFLOW_EXECUTIONS||e.name===u.EXECUTION_PREVIEW?this.activeHeaderTab=g.EXECUTIONS:(e.name===u.WORKFLOW||e.name===u.NEW_WORKFLOW||e.name===u.EXECUTION_DEBUG)&&(this.activeHeaderTab=g.WORKFLOW);const t=e.params.name;t!=="new"&&(this.workflowToReturnTo=t)},onTabSelected(e,t){const s=t.ctrlKey||t.metaKey;switch(e){case g.WORKFLOW:this.navigateToWorkflowView(s);break;case g.EXECUTIONS:this.navigateToExecutionsView(s);break}},async navigateToWorkflowView(e){let t;if(["","new",N].includes(this.workflowToReturnTo)?t={name:u.NEW_WORKFLOW}:t={name:u.WORKFLOW,params:{name:this.workflowToReturnTo}},e){const{href:s}=this.$router.resolve(t);window.open(s,"_blank")}else this.$route.name!==t.name&&(this.$route.name===u.NEW_WORKFLOW&&(this.uiStore.stateIsDirty=this.dirtyState),this.activeHeaderTab=g.WORKFLOW,await this.$router.push(t))},async navigateToExecutionsView(e){const t=this.currentWorkflow===N?"new":this.currentWorkflow,s=this.activeExecution?{name:u.EXECUTION_PREVIEW,params:{name:t,executionId:this.activeExecution.id}}:{name:u.EXECUTION_HOME,params:{name:t}};if(e){const{href:o}=this.$router.resolve(s);window.open(o,"_blank")}else this.$route.name!==s.name&&(this.dirtyState=this.uiStore.stateIsDirty,this.workflowToReturnTo=this.currentWorkflow,this.activeHeaderTab=g.EXECUTIONS,await this.$router.push(s))}}}),ts={class:"top-menu"};function ss(e,t,s,o,a,n){const l=i("WorkflowDetails"),f=i("TabBar");return r(),m("div",null,[E("div",{class:w({"main-header":!0,expanded:!e.uiStore.sidebarMenuCollapsed})},[Y(E("div",ts,[d(l,{"read-only":e.readOnly},null,8,["read-only"]),e.onWorkflowPage?(r(),_(f,{key:0,items:e.tabBarItems,"active-tab":e.activeHeaderTab,onSelect:e.onTabSelected},null,8,["items","active-tab","onSelect"])):M("",!0)],512),[[Me,!e.hideMenuBar]])],2)])}const Us=v(es,[["render",ss]]);export{Us as default};
//# sourceMappingURL=MainHeader-XuVcbTkd.js.map
