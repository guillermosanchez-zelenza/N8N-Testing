import{m as se}from"./pinia-aUqqC48i.js";import{P as re}from"./PushConnectionTracker-tj_z_KlE.js";import{e as ne}from"./executionsHelpers-KIs5lrX4.js";import{_ as I,e as Z,x as ee,fJ as ae,u as te,l as ce}from"./n8n-_nNvRoCf.js";import{u as P,W as L,p as K}from"./pushConnection-PNUo6dZ9.js";import{G as S,r as b,ag as g,l,m as d,p as k,T as u,O as p,H as Y,I as i,Q as J,M as C,S as w,R as s,F,a7 as E,u as f,e as X,b as ie,y as le}from"./vendor-NNwioulI.js";import{j as de}from"./index-xP-VuMjv.js";import{C as H}from"./vue-chartjs-vHhDSQKe.js";import"./dateFormatter-e3zTcyK4.js";import"./lodash-es-5z_C16pm.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./esprima-next-ulPLCZ1Z.js";import"./luxon-ZRIU05qF.js";import"./@vueuse/core-8g26_cc0.js";import"./uuid-McvpxQtQ.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";import"./collaboration.store-emJMSzVB.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";function oe(t){return t.reduce((a,n)=>a+n,0)/t.length}function ue(t){return oe(t).toFixed(2)}function B(t){return t/1024/1024/1024}const pe=S({__name:"WorkerAccordion.ee",props:{icon:{type:String,default:"tasks"},iconColor:{type:String,default:"black"},initialExpanded:{type:Boolean,default:!0}},setup(t){const n=b(t.initialExpanded);function c(){n.value=!n.value}return(o,m)=>{const e=g("n8n-icon"),h=g("n8n-text");return l(),d("div",{class:i(["accordion",o.$style.container])},[k("div",{class:i({[o.$style.header]:!0,[o.$style.expanded]:n.value}),onClick:c},[u(e,{icon:t.icon,color:t.iconColor,size:"small",class:"mr-2xs"},null,8,["icon","color"]),u(h,{class:i(o.$style.headerText),color:"text-base",size:"small",align:"left",bold:""},{default:p(()=>[Y(o.$slots,"title")]),_:3},8,["class"]),u(e,{icon:n.value?"chevron-up":"chevron-down",bold:""},null,8,["icon"])],2),n.value?(l(),d("div",{key:0,class:i({[o.$style.description]:!0,[o.$style.collapsed]:!n.value})},[Y(o.$slots,"content")],2)):J("",!0)],2)}}}),me="_container_jb2mu_5",_e="_header_jb2mu_9",he="_headerText_jb2mu_15",ke="_expanded_jb2mu_19",ye="_description_jb2mu_23",fe={container:me,header:_e,headerText:he,expanded:ke,description:ye},ge={$style:fe},N=I(pe,[["__cssModules",ge]]),$e=["href"],we=["href"],ve=S({__name:"WorkerJobAccordion.ee",props:{items:{}},setup(t){const a=t;function n(c){let o=Math.floor((new Date().getTime()-c.getTime())/1e3);const m=Math.floor(o/3600);o-=m*3600;const e=Math.floor(o/60);return o-=e*60,`${m}h ${e}m ${Math.floor(o)}s`}return(c,o)=>{const m=g("n8n-text");return l(),C(N,{icon:"tasks","icon-color":"black","initial-expanded":!0},{title:p(()=>[w(s(c.$locale.baseText("workerList.item.jobListTitle"))+" ("+s(c.items.length)+") ",1)]),content:p(()=>[a.items.length>0?(l(),d("div",{key:0,class:i(c.$style.accordionItems)},[(l(!0),d(F,null,E(a.items,e=>(l(),d("div",{key:e.executionId,class:i(c.$style.accordionItem)},[k("a",{href:"/workflow/"+e.workflowId+"/executions/"+e.executionId}," Execution "+s(e.executionId)+" - "+s(e.workflowName),9,$e),u(m,{color:"text-base",size:"small",align:"left"},{default:p(()=>{var h;return[w(" | Started at: "+s((h=new Date(e.startedAt))==null?void 0:h.toLocaleTimeString())+" | Running for "+s(n(new Date(e.startedAt)))+" "+s(e.retryOf?`| Retry of: ${e.retryOf}`:"")+" | ",1)]}),_:2},1024),k("a",{target:"_blank",href:"/workflow/"+e.workflowId}," (Open workflow)",8,we)],2))),128))],2)):(l(),d("div",{key:1,class:i(c.$style.accordionItems)},[k("span",{class:i(c.$style.empty)},s(c.$locale.baseText("workerList.item.jobList.empty")),3)],2))]),_:1})}}}),be="_accordionItems_lupqv_5",Me="_accordionItem_lupqv_5",Ie="_empty_lupqv_18",Se={accordionItems:be,accordionItem:Me,empty:Ie},Te={$style:Se},Le=I(ve,[["__cssModules",Te]]),Ce=["onClick"],xe=S({__name:"WorkerNetAccordion.ee",props:{items:{}},setup(t){const a=t,n=ee(),c=de(),{showMessage:o}=Z();function m(e){try{c.copy(e),o({title:n.baseText("workerList.item.copyAddressToClipboard"),type:"success"})}catch{}}return(e,h)=>(l(),C(N,{icon:"tasks","icon-color":"black","initial-expanded":!1},{title:p(()=>[w(s(e.$locale.baseText("workerList.item.netListTitle"))+" ("+s(e.items.length)+") ",1)]),content:p(()=>[a.items.length>0?(l(),d("div",{key:0,class:i(e.$style.accordionItems)},[(l(!0),d(F,null,E(a.items,y=>(l(),d("div",{key:y.address,class:i(e.$style.accordionItem),onClick:r=>m(y.address)},[w(s(y.family)+": ",1),k("span",{class:i(e.$style.clickable)},s(y.address),3),w(" "+s(y.internal?"(internal)":""),1)],10,Ce))),128))],2)):J("",!0)]),_:1}))}}),Ae="_accordionItems_v7u0l_5",We="_accordionItem_v7u0l_5",Ue="_clickable_v7u0l_19",Be={accordionItems:Ae,accordionItem:We,clickable:Ue},Re={$style:Be},je=I(xe,[["__cssModules",Re]]),De=S({__name:"WorkerChartsAccordion.ee",props:{workerId:{}},setup(t){var V,q,z;const a=t,n=(v,x,T=0)=>({datasets:[{label:v,backgroundColor:x,data:T?Array(Math.min(L,T)).fill(0):[]}],labels:Array(Math.min(L,T)).fill("")}),c=P(),o=b(void 0),m=b(void 0),e=b(void 0),h=()=>({responsive:!0,maintainAspectRatio:!0,scales:{y:{type:"linear",display:!0,position:"left",min:0,suggestedMax:5}}}),y=h(),r=h();(V=r.scales)!=null&&V.y&&(r.scales.y.suggestedMax=100);const _=B((q=c.workers[a.workerId])==null?void 0:q.totalMem)??1,$=h();(z=$.scales)!=null&&z.y&&($.scales.y.suggestedMax=_);const M=b(n("Job Count","rgb(255, 111, 92)",L)),W=b(n("Processor Usage","rgb(19, 205, 103)",L)),O=b(n("Memory Usage","rgb(244, 216, 174)",L));return c.$onAction(({name:v,store:x})=>{var T,G;if(v==="updateWorkerStatus"){const R=L-(((T=x.workersHistory[a.workerId])==null?void 0:T.length)??0),A=n("Job Count","rgb(255, 111, 92)",R),j=n("Processor Usage","rgb(19, 205, 103)",R),D=n("Memory Usage","rgb(244, 216, 174)",R);(G=x.workersHistory[a.workerId])==null||G.forEach(U=>{var Q;A.datasets[0].data.push(U.data.runningJobsSummary.length),(Q=A.labels)==null||Q.push(new Date(U.timestamp).toLocaleTimeString()),j.datasets[0].data.push(oe(U.data.loadAvg)),j.labels=A.labels,D.datasets[0].data.push(_-B(U.data.freeMem)),D.labels=A.labels}),M.value=A,W.value=j,O.value=D}}),(v,x)=>(l(),C(N,{icon:"tasks","icon-color":"black","initial-expanded":!1},{title:p(()=>[w(s(v.$locale.baseText("workerList.item.chartsTitle")),1)]),content:p(()=>[k("div",{class:i(v.$style.charts)},[u(f(H),{ref_key:"chartRefJobs",ref:o,type:"line",data:M.value,options:f(y),class:i(v.$style.chart)},null,8,["data","options","class"]),u(f(H),{ref_key:"chartRefCPU",ref:m,type:"line",data:W.value,options:f(r),class:i(v.$style.chart)},null,8,["data","options","class"]),u(f(H),{ref_key:"chartRefMemory",ref:e,type:"line",data:O.value,options:f($),class:i(v.$style.chart)},null,8,["data","options","class"])],2)]),_:1}))}}),He="_accordionItems_1k0p0_5",Pe="_accordionItem_1k0p0_5",Je="_charts_1k0p0_18",Fe="_chart_1k0p0_18",Ee={accordionItems:He,accordionItem:Pe,charts:Je,chart:Fe},Ne={$style:Ee},Oe=I(De,[["__cssModules",Ne]]),Ve=k("br",null,null,-1),qe=S({__name:"WorkerCard.ee",props:{workerId:{}},setup(t){const a=t;let n;const c=P(),o=b("0"),m=b(!1),e=X(()=>c.getWorkerStatus(a.workerId)),h=X(()=>{var r;return((r=e.value)==null?void 0:r.interfaces.toSorted((_,$)=>_.family.localeCompare($.family)))??[]});function y(r){const _=Math.floor(r/86400);r-=_*3600*24;const $=Math.floor(r/3600);r-=$*3600;const M=Math.floor(r/60);return r-=M*60,`${_}d ${$}h ${M}m ${Math.floor(r)}s`}return ie(()=>{n=setInterval(()=>{const r=c.getWorkerLastUpdated(a.workerId);if(!r)return;const _=Math.ceil((Date.now()-r)/1e3);m.value=_>10,o.value=_.toFixed(0)},500)}),le(()=>{clearInterval(n)}),(r,_)=>{const $=g("n8n-heading"),M=g("n8n-text"),W=g("n8n-card");return e.value?(l(),C(W,{key:0,class:i(r.$style.cardLink)},{header:p(()=>[u($,{tag:"h2",bold:"",class:i(m.value?[r.$style.cardHeading,r.$style.stale]:[r.$style.cardHeading]),"data-test-id":"worker-card-name"},{default:p(()=>[w(" Name: "+s(e.value.workerId)+" ("+s(e.value.hostname)+") ",1),Ve,w(" Average Load: "+s(f(ue)(e.value.loadAvg??[0]))+" | Free Memory: "+s(f(B)(e.value.freeMem).toFixed(2))+"GB / "+s(f(B)(e.value.totalMem).toFixed(2))+"GB "+s(m.value?" (stale)":""),1)]),_:1},8,["class"])]),append:p(()=>[k("div",{ref:"cardActions",class:i(r.$style.cardActions)},null,2)]),default:p(()=>[k("div",{class:i(r.$style.cardDescription)},[u(M,{color:"text-light",size:"small",class:i(r.$style.container)},{default:p(()=>[k("span",null,s(r.$locale.baseText("workerList.item.lastUpdated"))+" "+s(o.value)+"s ago | n8n-Version: "+s(e.value.version)+" | Architecture: "+s(e.value.arch)+" ( "+s(e.value.platform)+") | Uptime: "+s(y(e.value.uptime)),1),u(Le,{items:e.value.runningJobsSummary},null,8,["items"]),u(je,{items:h.value},null,8,["items"]),u(Oe,{"worker-id":e.value.workerId},null,8,["worker-id"])]),_:1},8,["class"])],2)]),_:1},8,["class"])):J("",!0)}}}),ze="_container_124hj_5",Ge="_cardLink_124hj_9",Qe="_cardHeading_124hj_19",Ke="_stale_124hj_25",Ye="_cardDescription_124hj_29",Xe="_cardActions_124hj_36",Ze={container:ze,cardLink:Ge,cardHeading:Qe,stale:Ke,cardDescription:Ye,cardActions:Xe},et={$style:Ze},tt=I(qe,[["__cssModules",et]]),ot=S({name:"WorkerList",components:{PushConnectionTracker:re,WorkerCard:tt},mixins:[K,ne],props:{autoRefreshEnabled:{type:Boolean,default:!0}},setup(t,a){var c,o;return{i18n:ee(),...Z(),...(o=(c=K).setup)==null?void 0:o.call(c,t,a)}},mounted(){ae(`n8n - ${this.pageTitle}`),this.$telemetry.track("User viewed worker view",{instance_id:this.rootStore.instanceId})},beforeMount(){window.Cypress===void 0&&(this.pushStore.pushConnect(),this.orchestrationManagerStore.startWorkerStatusPolling())},beforeUnmount(){window.Cypress===void 0&&(this.orchestrationManagerStore.stopWorkerStatusPolling(),this.pushStore.pushDisconnect())},computed:{...se(te,P),combinedWorkers(){const t=[];for(const a in this.orchestrationManagerStore.workers)t.push(this.orchestrationManagerStore.workers[a]);return t},initialStatusReceived(){return this.orchestrationManagerStore.initialStatusReceived},workerIds(){return Object.keys(this.orchestrationManagerStore.workers)},pageTitle(){return this.i18n.baseText("workerList.pageTitle")}},methods:{averageLoadAvg(t){return(t.reduce((a,n)=>a+n,0)/t.length).toFixed(2)},getStatus(t){return t.runningJobsSummary.length>0?"running":"success"},getRowClass(t){return[this.$style.execRow,this.$style[this.getStatus(t)]].join(" ")}}}),st="_workerListHeader_q7mrl_5",rt="_card_q7mrl_12",nt="_tableLoader_q7mrl_16",at={workerListHeader:st,card:rt,tableLoader:nt},ct={key:0},it={key:1},lt={key:0},dt={key:1};function ut(t,a,n,c,o,m){const e=g("PushConnectionTracker"),h=g("n8n-heading"),y=g("n8n-spinner"),r=g("WorkerCard");return l(),d("div",null,[u(e,{class:"actions"}),k("div",{class:i(t.$style.workerListHeader)},[u(h,{tag:"h1",size:"2xlarge"},{default:p(()=>[w(s(t.pageTitle),1)]),_:1})],2),t.initialStatusReceived?(l(),d("div",it,[t.workerIds.length===0?(l(),d("div",lt,s(t.$locale.baseText("workerList.empty")),1)):(l(),d("div",dt,[(l(!0),d(F,null,E(t.workerIds,_=>(l(),d("div",{key:_,class:i(t.$style.card)},[u(r,{"worker-id":_,"data-test-id":"worker-card"},null,8,["worker-id"])],2))),128))]))])):(l(),d("div",ct,[u(y)]))])}const pt={$style:at},mt=I(ot,[["render",ut],["__cssModules",pt]]),_t=["href"],ht=S({__name:"WorkerView",setup(t){const a=ce(),n=te(),c=()=>{n.goToUpgrade("worker-view","upgrade-worker-view")};return(o,m)=>{const e=g("n8n-action-box");return f(a).isQueueModeEnabled&&f(a).isWorkerViewAvailable?(l(),C(mt,{key:0,"data-test-id":"worker-view-licensed"})):(l(),C(e,{key:1,"data-test-id":"worker-view-unlicensed",class:i(o.$style.actionBox),description:o.$locale.baseText("workerList.actionBox.description"),"button-text":o.$locale.baseText("workerList.actionBox.buttonText"),"onClick:button":c},{heading:p(()=>[k("span",null,s(o.$locale.baseText("workerList.actionBox.title")),1)]),description:p(()=>[w(s(o.$locale.baseText("workerList.actionBox.description"))+" ",1),k("a",{href:o.$locale.baseText("workerList.docs.url"),target:"_blank"},s(o.$locale.baseText("workerList.actionBox.description.link")),9,_t)]),_:1},8,["class","description","button-text"]))}}}),kt="_actionBox_wwwe5_5",yt={actionBox:kt},ft={$style:yt},Zt=I(ht,[["__cssModules",ft]]);export{Zt as default};
//# sourceMappingURL=WorkerView-fcXfHzsZ.js.map
