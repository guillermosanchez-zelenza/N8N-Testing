import{m as L}from"./pinia-aUqqC48i.js";import{u as q,_ as v,t as z,f as K,aM as G,l as Q,x as J}from"./n8n-_nNvRoCf.js";import{G as S,l,m as d,p as y,I as n,H as h,Q as m,ag as r,T as i,M as f,O as o,V as O,U as R,S as u,R as c,a9 as X,F as P,a7 as Y,ab as Z,al as x}from"./vendor-NNwioulI.js";const ee=S({name:"PageViewLayout",data(){return{loading:!1}},computed:{...L(q)}}),se="_wrapper_z85zu_5",te="_container_z85zu_20",re="_aside_z85zu_29",le="_content_z85zu_43",oe={wrapper:se,container:te,aside:re,content:le};function ie(e,s,t,w,p,_){return l(),d("div",{class:n([e.$style.wrapper,!e.uiStore.sidebarMenuCollapsed&&e.$style.expandedSidebar])},[y("div",{class:n(e.$style.container)},[e.$slots.aside?(l(),d("aside",{key:0,class:n(e.$style.aside)},[h(e.$slots,"aside")],2)):m("",!0),y("main",{class:n(e.$style.content)},[h(e.$slots,"default")],2)],2)],2)}const ae={$style:oe},ne=v(ee,[["render",ie],["__cssModules",ae]]),de=S({props:{overflow:{type:Boolean,default:!1}}}),ue="_wrapper_l75f8_5",he="_overflow_l75f8_11",pe="_list_l75f8_11",ce="_body_l75f8_11",fe="_header_l75f8_21",me={wrapper:ue,overflow:he,list:pe,body:ce,header:fe};function ye(e,s,t,w,p,_){return l(),d("div",{class:n({[e.$style.wrapper]:!0,[e.$style.overflow]:e.overflow})},[y("div",{class:n(e.$style.list)},[e.$slots.header?(l(),d("div",{key:0,class:n(e.$style.header)},[h(e.$slots,"header")],2)):m("",!0),y("div",{class:n(e.$style.body)},[h(e.$slots,"default")],2)],2)],2)}const we={$style:me},be=v(de,[["render",ye],["__cssModules",we]]),$e=S({props:{value:{type:Boolean,default:!0},myResourcesLabel:{type:String,default:""},allResourcesLabel:{type:String,default:""}},computed:{menuItems(){return[{id:"all",icon:"globe-americas",label:this.allResourcesLabel,position:"top"},{id:"owner",icon:"user",label:this.myResourcesLabel,position:"top"}]}},methods:{onSelectOwner(e){this.$emit("update:modelValue",e==="owner")}}}),ge={class:"resource-ownership-select"};function ve(e,s,t,w,p,_){const $=r("n8n-menu");return l(),d("div",ge,[i($,{items:e.menuItems,mode:"tabs","model-value":e.value?"owner":"all","onUpdate:modelValue":e.onSelectOwner},null,8,["items","model-value","onUpdate:modelValue"])])}const Se=v($e,[["render",ve],["__scopeId","data-v-9a464b9f"]]),_e=S({props:{modelValue:{type:Object,default:()=>({})},keys:{type:Array,default:()=>[]},shareable:{type:Boolean,default:!0},reset:{type:Function}},data(){return{EnterpriseEditionFeature:z}},computed:{...L(K),ownedByUsers(){return this.usersStore.allUsers.map(e=>e.id===this.modelValue.sharedWith?{...e,disabled:!0}:e)},sharedWithUsers(){return this.usersStore.allUsers.map(e=>e.id===this.modelValue.ownedBy?{...e,disabled:!0}:e)},filtersLength(){let e=0;return this.keys.forEach(s=>{s!=="search"&&(e+=(Array.isArray(this.modelValue[s])?this.modelValue[s].length>0:this.modelValue[s]!=="")?1:0)}),e},hasFilters(){return this.filtersLength>0}},watch:{filtersLength(e){this.$emit("update:filtersLength",e)}},methods:{setKeyValue(e,s){const t={...this.modelValue,[e]:s};this.$emit("update:modelValue",t)},resetFilters(){if(this.reset)this.reset();else{const e={...this.modelValue};this.keys.forEach(s=>{e[s]=Array.isArray(this.modelValue[s])?[]:""}),this.$emit("update:modelValue",e)}}}}),Fe={"filter-button":"_filter-button_157qk_5","filters-dropdown":"_filters-dropdown_157qk_10","filters-dropdown-footer":"_filters-dropdown-footer_157qk_15"};function ke(e,s,t,w,p,_){const $=r("n8n-badge"),V=r("n8n-button"),F=r("n8n-input-label"),k=r("n8n-user-select"),b=r("enterprise-edition"),T=r("n8n-link"),U=r("n8n-popover");return l(),f(U,{trigger:"click",width:"304",size:"large"},{reference:o(()=>[i(V,{icon:"filter",type:"tertiary",active:e.hasFilters,class:n([e.$style["filter-button"],"ml-2xs"]),"data-test-id":"resources-list-filters-trigger"},{default:o(()=>[O(i($,{theme:"primary",class:"mr-4xs"},{default:o(()=>[u(c(e.filtersLength),1)]),_:1},512),[[R,e.filtersLength>0]]),u(" "+c(e.$locale.baseText("forms.resourceFiltersDropdown.filters")),1)]),_:1},8,["active","class"])]),default:o(()=>[y("div",{class:n(e.$style["filters-dropdown"]),"data-test-id":"resources-list-filters-dropdown"},[h(e.$slots,"default",{filters:e.modelValue,setKeyValue:e.setKeyValue}),e.shareable?(l(),f(b,{key:0,class:"mb-s",features:[e.EnterpriseEditionFeature.Sharing]},{default:o(()=>[i(F,{label:e.$locale.baseText("forms.resourceFiltersDropdown.ownedBy"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),i(k,{users:e.ownedByUsers,"current-user-id":e.usersStore.currentUser.id,"model-value":e.modelValue.ownedBy,size:"medium","onUpdate:modelValue":s[0]||(s[0]=g=>e.setKeyValue("ownedBy",g))},null,8,["users","current-user-id","model-value"])]),_:1},8,["features"])):m("",!0),e.shareable?(l(),f(b,{key:1,features:[e.EnterpriseEditionFeature.Sharing]},{default:o(()=>[i(F,{label:e.$locale.baseText("forms.resourceFiltersDropdown.sharedWith"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),i(k,{users:e.sharedWithUsers,"current-user-id":e.usersStore.currentUser.id,"model-value":e.modelValue.sharedWith,size:"medium","onUpdate:modelValue":s[1]||(s[1]=g=>e.setKeyValue("sharedWith",g))},null,8,["users","current-user-id","model-value"])]),_:1},8,["features"])):m("",!0),e.hasFilters?(l(),d("div",{key:2,class:n([e.$style["filters-dropdown-footer"],"mt-s"])},[i(T,{onClick:e.resetFilters},{default:o(()=>[u(c(e.$locale.baseText("forms.resourceFiltersDropdown.reset")),1)]),_:1},8,["onClick"])],2)):m("",!0)],2)]),_:3})}const Ve={$style:Fe},Te=v(_e,[["render",ke],["__cssModules",Ve]]),Ue=S({name:"ResourcesListLayout",components:{PageViewLayout:ne,PageViewLayoutList:be,ResourceOwnershipSelect:Se,ResourceFiltersDropdown:Te},props:{resourceKey:{type:String,default:""},displayName:{type:Function,default:e=>e.name},resources:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},initialize:{type:Function,default:()=>async()=>{}},filters:{type:Object,default:()=>({search:"",ownedBy:"",sharedWith:""})},additionalFiltersHandler:{type:Function},showAside:{type:Boolean,default:!0},shareable:{type:Boolean,default:!0},showFiltersDropdown:{type:Boolean,default:!0},sortFns:{type:Object,default:()=>({})},sortOptions:{type:Array,default:()=>["lastUpdated","lastCreated","nameAsc","nameDesc"]},type:{type:String,default:"list"},typeProps:{type:Object,default:()=>({itemSize:80})}},setup(){const e=J(),{callDebounced:s}=G();return{i18n:e,callDebounced:s}},data(){return{loading:!0,isOwnerSubview:!1,sortBy:this.sortOptions[0],hasFilters:!1,filtersModel:{...this.filters},currentPage:1,rowsPerPage:10,resettingFilters:!1,EnterpriseEditionFeature:z}},computed:{...L(Q,K),subviewResources(){return this.shareable?this.resources.filter(e=>{var s;return this.isOwnerSubview&&this.settingsStore.isEnterpriseFeatureEnabled(z.Sharing)?!!(e.ownedBy&&e.ownedBy.id===((s=this.usersStore.currentUser)==null?void 0:s.id)):!0}):this.resources},filterKeys(){return Object.keys(this.filtersModel)},filteredAndSortedSubviewResources(){return this.subviewResources.filter(s=>{var w;let t=!0;if(this.filtersModel.ownedBy&&(t=t&&!!(s.ownedBy&&s.ownedBy.id===this.filtersModel.ownedBy)),this.filtersModel.sharedWith&&(t=t&&!!((w=s.sharedWith)!=null&&w.find(p=>p.id===this.filtersModel.sharedWith))),this.filtersModel.search){const p=this.filtersModel.search.toLowerCase();t=t&&this.displayName(s).toLowerCase().includes(p)}return this.additionalFiltersHandler&&(t=this.additionalFiltersHandler(s,this.filtersModel,t)),t}).sort((s,t)=>{switch(this.sortBy){case"lastUpdated":return this.sortFns.lastUpdated?this.sortFns.lastUpdated(s,t):new Date(t.updatedAt).valueOf()-new Date(s.updatedAt).valueOf();case"lastCreated":return this.sortFns.lastCreated?this.sortFns.lastCreated(s,t):new Date(t.createdAt).valueOf()-new Date(s.createdAt).valueOf();case"nameAsc":return this.sortFns.nameAsc?this.sortFns.nameAsc(s,t):this.displayName(s).trim().localeCompare(this.displayName(t).trim());case"nameDesc":return this.sortFns.nameDesc?this.sortFns.nameDesc(s,t):this.displayName(t).trim().localeCompare(this.displayName(s).trim());default:return this.sortFns[this.sortBy]?this.sortFns[this.sortBy](s,t):0}})},resourcesNotOwned(){return this.resources.filter(e=>{var s;return e.ownedBy&&e.ownedBy.id!==((s=this.usersStore.currentUser)==null?void 0:s.id)})},shouldSwitchToAllSubview(){return!this.hasFilters&&this.isOwnerSubview&&this.resourcesNotOwned.length>0}},watch:{isOwnerSubview(){this.sendSubviewTelemetry()},filters(e){this.filtersModel=e},"filtersModel.ownedBy"(e){e&&this.setOwnerSubview(!1),this.sendFiltersTelemetry("ownedBy")},"filtersModel.sharedWith"(){this.sendFiltersTelemetry("sharedWith")},"filtersModel.search"(){this.callDebounced(this.sendFiltersTelemetry,{debounceTime:1e3,trailing:!0},"search")},sortBy(e){this.$emit("sort",e),this.sendSortingTelemetry()}},mounted(){this.onMounted()},methods:{async onMounted(){await this.initialize(),this.loading=!1,await this.$nextTick(),this.focusSearchInput(),this.hasAppliedFilters()&&(this.hasFilters=!0)},hasAppliedFilters(){return!!this.filterKeys.find(e=>e!=="search"&&(Array.isArray(this.filters[e])?this.filters[e].length>0:this.filters[e]!==""))},setCurrentPage(e){this.currentPage=e},setRowsPerPage(e){this.rowsPerPage=e},resetFilters(){Object.keys(this.filtersModel).forEach(e=>{this.filtersModel[e]=Array.isArray(this.filtersModel[e])?[]:""}),this.resettingFilters=!0,this.sendFiltersTelemetry("reset"),this.$emit("update:filters",this.filtersModel)},focusSearchInput(){this.$refs.search&&this.$refs.search.focus()},setOwnerSubview(e){this.isOwnerSubview=e},getTelemetrySubview(){return this.i18n.baseText(`${this.resourceKey}.menu.${this.isOwnerSubview?"my":"all"}`)},sendSubviewTelemetry(){this.$telemetry.track(`User changed ${this.resourceKey} sub view`,{sub_view:this.getTelemetrySubview()})},sendSortingTelemetry(){this.$telemetry.track(`User changed sorting in ${this.resourceKey} list`,{sub_view:this.getTelemetrySubview(),sorting:this.sortBy})},sendFiltersTelemetry(e){if(this.resettingFilters){if(e!=="reset")return;setTimeout(()=>this.resettingFilters=!1,1500)}const s=this.filtersModel,t=[],w=[];Object.keys(s).forEach(p=>{s[p]&&(t.push(p),w.push(p==="search"?null:s[p]))}),this.$telemetry.track(`User set filters in ${this.resourceKey} list`,{filters_set:t,filter_values:w,sub_view:this.getTelemetrySubview(),[`${this.resourceKey}_total_in_view`]:this.subviewResources.length,[`${this.resourceKey}_after_filtering`]:this.filteredAndSortedSubviewResources.length})},onUpdateFiltersLength(e){this.hasFilters=e>0},onSearch(e){this.filtersModel.search=e,this.$emit("update:filters",this.filtersModel)}}}),Be="_search_1l5ez_16",Me="_listWrapper_1l5ez_20",Pe="_datatable_1l5ez_39",ze={"heading-wrapper":"_heading-wrapper_1l5ez_5","filters-row":"_filters-row_1l5ez_9",search:Be,listWrapper:Me,"sort-and-filter":"_sort-and-filter_1l5ez_24","header-loading":"_header-loading_1l5ez_31","card-loading":"_card-loading_1l5ez_35",datatable:Pe},Le={class:"mt-xs mb-l"},Ke={key:0},Oe={key:0},Re={class:"mb-xs"},Ae={key:0,class:"mt-xs"},Ce=y("div",{class:"pb-xs"},null,-1),De={key:0},We={key:1};function Ee(e,s,t,w,p,_){const $=r("n8n-heading"),V=r("n8n-button"),F=r("ResourceOwnershipSelect"),k=r("enterprise-edition"),b=r("n8n-loading"),T=r("n8n-action-box"),U=r("n8n-icon"),g=r("n8n-input"),A=r("n8n-option"),C=r("n8n-select"),D=r("ResourceFiltersDropdown"),B=r("n8n-link"),W=r("n8n-info-tip"),E=r("n8n-recycle-scroller"),N=r("n8n-datatable"),j=r("n8n-text"),I=r("PageViewLayoutList"),H=r("PageViewLayout");return l(),f(H,null,X({default:o(()=>[e.loading?(l(),d("div",Ke,[i(b,{class:n([e.$style["header-loading"],"mb-l"]),variant:"custom"},null,8,["class"]),i(b,{class:n([e.$style["card-loading"],"mb-2xs"]),variant:"custom"},null,8,["class"]),i(b,{class:n(e.$style["card-loading"]),variant:"custom"},null,8,["class"])])):(l(),d(P,{key:1},[e.resources.length===0?(l(),d("div",Oe,[h(e.$slots,"empty",{},()=>[i(T,{"data-test-id":"empty-resources-list",emoji:"👋",heading:e.i18n.baseText(e.usersStore.currentUser.firstName?`${e.resourceKey}.empty.heading`:`${e.resourceKey}.empty.heading.userNotSetup`,{interpolate:{name:e.usersStore.currentUser.firstName}}),description:e.i18n.baseText(`${e.resourceKey}.empty.description`),"button-text":e.i18n.baseText(`${e.resourceKey}.empty.button`),"button-type":"secondary","onClick:button":s[2]||(s[2]=a=>e.$emit("click:add",a))},null,8,["heading","description","button-text"])])])):(l(),f(I,{key:1,overflow:e.type!=="list"},{header:o(()=>[y("div",Re,[y("div",{class:n(e.$style["filters-row"])},[i(g,{ref:"search","model-value":e.filtersModel.search,class:n([e.$style.search,"mr-2xs"]),placeholder:e.i18n.baseText(`${e.resourceKey}.search.placeholder`),clearable:"","data-test-id":"resources-list-search","onUpdate:modelValue":e.onSearch},{prefix:o(()=>[i(U,{icon:"search"})]),_:1},8,["model-value","class","placeholder","onUpdate:modelValue"]),y("div",{class:n(e.$style["sort-and-filter"])},[i(C,{modelValue:e.sortBy,"onUpdate:modelValue":s[3]||(s[3]=a=>e.sortBy=a),"data-test-id":"resources-list-sort"},{default:o(()=>[(l(!0),d(P,null,Y(e.sortOptions,a=>(l(),f(A,{key:a,"data-test-id":"resources-list-sort-item",value:a,label:e.i18n.baseText(`${e.resourceKey}.sort.${a}`)},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),e.showFiltersDropdown?(l(),f(D,{key:0,keys:e.filterKeys,reset:e.resetFilters,"model-value":e.filtersModel,shareable:e.shareable,"onUpdate:modelValue":s[4]||(s[4]=a=>e.$emit("update:filters",a)),"onUpdate:filtersLength":e.onUpdateFiltersLength},{default:o(a=>[h(e.$slots,"filters",Z(x(a)))]),_:3},8,["keys","reset","model-value","shareable","onUpdate:filtersLength"])):m("",!0)],2)],2)]),h(e.$slots,"callout"),e.showFiltersDropdown?O((l(),d("div",Ae,[i(W,{bold:!1},{default:o(()=>[u(c(e.i18n.baseText(`${e.resourceKey}.filters.active`))+" ",1),i(B,{"data-test-id":"workflows-filter-reset",size:"small",onClick:e.resetFilters},{default:o(()=>[u(c(e.i18n.baseText(`${e.resourceKey}.filters.active.reset`)),1)]),_:1},8,["onClick"])]),_:1})],512)),[[R,e.hasFilters]]):m("",!0),Ce]),default:o(()=>[h(e.$slots,"preamble"),e.filteredAndSortedSubviewResources.length>0?(l(),d("div",{key:0,ref:"listWrapperRef",class:n(e.$style.listWrapper)},[e.type==="list"?(l(),f(E,{key:0,"data-test-id":"resources-list",class:n([e.$style.list,"list-style-none"]),items:e.filteredAndSortedSubviewResources,"item-size":e.typeProps.itemSize,"item-key":"id"},{default:o(({item:a,updateItemSize:M})=>[h(e.$slots,"default",{data:a,updateItemSize:M})]),postListContent:o(()=>[h(e.$slots,"postListContent")]),_:3},8,["class","items","item-size"])):m("",!0),e.typeProps.columns?(l(),f(N,{key:1,"data-test-id":"resources-table",class:n(e.$style.datatable),columns:e.typeProps.columns,rows:e.filteredAndSortedSubviewResources,"current-page":e.currentPage,"rows-per-page":e.rowsPerPage,"onUpdate:currentPage":e.setCurrentPage,"onUpdate:rowsPerPage":e.setRowsPerPage},{row:o(({columns:a,row:M})=>[h(e.$slots,"default",{data:M,columns:a})]),_:3},8,["class","columns","rows","current-page","rows-per-page","onUpdate:currentPage","onUpdate:rowsPerPage"])):m("",!0)],2)):(l(),f(j,{key:1,color:"text-base",size:"medium","data-test-id":"resources-list-empty"},{default:o(()=>[u(c(e.i18n.baseText(`${e.resourceKey}.noResults`))+" ",1),e.shouldSwitchToAllSubview?(l(),d(P,{key:0},[e.filtersModel.search?(l(),d("span",We,[u(" ("+c(e.i18n.baseText(`${e.resourceKey}.noResults.withSearch.switchToShared.preamble`))+" ",1),i(B,{onClick:s[6]||(s[6]=a=>e.setOwnerSubview(!1))},{default:o(()=>[u(c(e.i18n.baseText(`${e.resourceKey}.noResults.withSearch.switchToShared.link`)),1)]),_:1}),u(") ")])):(l(),d("span",De,[u(" ("+c(e.i18n.baseText(`${e.resourceKey}.noResults.switchToShared.preamble`))+" ",1),i(B,{onClick:s[5]||(s[5]=a=>e.setOwnerSubview(!1))},{default:o(()=>[u(c(e.i18n.baseText(`${e.resourceKey}.noResults.switchToShared.link`)),1)]),_:1}),u(") ")]))],64)):m("",!0)]),_:1})),h(e.$slots,"postamble")]),_:3},8,["overflow"]))],64))]),_:2},[e.showAside?{name:"aside",fn:o(()=>[y("div",{class:n([e.$style["heading-wrapper"],"mb-xs"])},[i($,{size:"2xlarge"},{default:o(()=>[u(c(e.i18n.baseText(`${e.resourceKey}.heading`)),1)]),_:1})],2),y("div",Le,[h(e.$slots,"add-button",{disabled:e.disabled},()=>[i(V,{size:"large",block:"",disabled:e.disabled,"data-test-id":"resources-list-add",onClick:s[0]||(s[0]=a=>e.$emit("click:add",a))},{default:o(()=>[u(c(e.i18n.baseText(`${e.resourceKey}.add`)),1)]),_:1},8,["disabled"])])]),e.shareable?(l(),f(k,{key:0,features:[e.EnterpriseEditionFeature.Sharing]},{default:o(()=>[i(F,{modelValue:e.isOwnerSubview,"onUpdate:modelValue":s[1]||(s[1]=a=>e.isOwnerSubview=a),"my-resources-label":e.i18n.baseText(`${e.resourceKey}.menu.my`),"all-resources-label":e.i18n.baseText(`${e.resourceKey}.menu.all`)},null,8,["modelValue","my-resources-label","all-resources-label"])]),_:1},8,["features"])):m("",!0)]),key:"0"}:void 0]),1024)}const Ne={$style:ze},qe=v(Ue,[["render",Ee],["__cssModules",Ne]]);export{qe as R};
//# sourceMappingURL=ResourcesListLayout--pg3flTX.js.map
