import{r as L,e as k,G as K,aI as x,aJ as z,d as q,D as G,b as J,ag as W,l as o,M as f,O as S,u as a,S as O,R as V,p as b,I as u,m as A,F as Q,a7 as X,T as g}from"./vendor-NNwioulI.js";import{d as j}from"./pinia-aUqqC48i.js";import{y as Y,B as Z,m as ee,v as te,V as E,a7 as $,a5 as ae,O as D,as as se,fM as oe,dF as le,fN as ne,x as re,_ as ie}from"./n8n-_nNvRoCf.js";import{I as de,aC as pe,aD as ue,aE as ce}from"./index-xP-VuMjv.js";import{c as me}from"./templateActions-cwvPeOiI.js";import{T as fe}from"./TemplatesView-iIGCTbv6.js";import"./lodash-es-5z_C16pm.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./esprima-next-ulPLCZ1Z.js";import"./luxon-ZRIU05qF.js";import"./@vueuse/core-8g26_cc0.js";import"./uuid-McvpxQtQ.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";const ye=j("setupTemplate",()=>{const l=L(""),e=L(!0),d=L(!1),c=de(),y=Y(),i=Z(),w=ee(),N=te(),n=k(()=>l.value?c.getFullTemplateById(l.value):null),R=k(()=>{var s;return((s=n.value)==null?void 0:s.workflow.nodes)??[]}),{appCredentials:P,credentialOverrides:I,credentialUsages:t,credentialsByKey:r,nodesRequiringCredentialsSorted:m,numFilledCredentials:h,selectedCredentialIdByKey:T,setSelectedCredentialId:p,unsetSelectedCredential:F}=pe(R),v=s=>{l.value=s},H=new Set(["httpBasicAuth","httpCustomAuth","httpDigestAuth","httpHeaderAuth","oAuth1Api","oAuth2Api","httpQueryAuth"]),M=()=>{for(const s of t.value){if(H.has(s.credentialType))continue;const _=i.getCredentialsByType(s.credentialType);_.length===1&&(T.value[s.key]=_[0].id)}},U=async()=>{n.value||!l.value||(await c.fetchTemplateById(l.value),M())};return{credentialsByKey:r,isLoading:e,isSaving:d,appCredentials:P,nodesRequiringCredentialsSorted:m,template:n,credentialUsages:t,selectedCredentialIdByKey:T,credentialOverrides:I,numFilledCredentials:h,createWorkflow:async s=>{const{router:_}=s,C=D();if(n.value)try{d.value=!0;const B=await me({template:n.value,credentialOverrides:I.value,rootStore:w,workflowsStore:N,nodeTypeProvider:y});C.track("User closed cred setup",{completed:!0,creds_filled:h.value,creds_needed:t.value.length,workflow_id:B.id}),C.track("User inserted workflow template",{source:"workflow",template_id:$(l.value),wf_template_repo_session_id:c.currentSessionId},{withPostHog:!0}),C.track("User saved new workflow from template",{template_id:$(l.value),workflow_id:B.id,wf_template_repo_session_id:c.currentSessionId}),await _.replace({name:E.WORKFLOW,params:{name:B.id}})}finally{d.value=!1}},skipSetup:async({router:s})=>{const _=ae(),C=D();await _.run("templatesWorkflowView.openWorkflow",{source:"workflow",template_id:l.value,wf_template_repo_session_id:c.currentSessionId}),C.track("User closed cred setup",{completed:!1,creds_filled:0,creds_needed:t.value.length,workflow_id:null}),await s.replace({name:E.TEMPLATE_IMPORT,params:{id:l.value}})},init:async()=>{e.value=!0;try{T.value={},await Promise.all([i.fetchAllCredentials(),i.fetchCredentialTypes(!1),y.loadNodeTypesIfNotLoaded(),U()]),M()}finally{e.value=!1}},loadTemplateIfNeeded:U,setInitialCredentialSelection:M,setTemplateId:v,setSelectedCredentialId:p,unsetSelectedCredential:F}}),we={key:1},ve=K({__name:"SetupWorkflowFromTemplateView",setup(l){const e=ye(),d=re(),c=se(),y=x(),i=z(),w=k(()=>Array.isArray(y.params.id)?y.params.id[0]:y.params.id),N=k(()=>{var t;return((t=e.template)==null?void 0:t.name)??"unknown"}),n=k(()=>!e.isLoading),R=k(()=>i.resolve({name:E.TEMPLATE_IMPORT,params:{id:w.value}}).fullPath);q(w,async t=>{e.setTemplateId(t),await e.loadTemplateIfNeeded()});const P=async t=>{t.preventDefault(),await e.skipSetup({router:i})},I=async()=>!e.template?!1:e.credentialUsages.length===0?(await e.skipSetup({router:i}),!0):!1;return e.setTemplateId(w.value),G(async()=>{c.isFeatureEnabled(oe)||i.replace({name:E.TEMPLATE_IMPORT,params:{id:w.value}})}),J(async()=>{await e.init(),await I()}),(t,r)=>{const m=W("n8n-loading"),h=W("n8n-button"),T=W("n8n-tooltip");return o(),f(fe,{"go-back-enabled":!0},{header:S(()=>[n.value?(o(),f(a(le),{key:0,tag:"h1",size:"2xlarge"},{default:S(()=>[O(V(a(d).baseText("templateSetup.title",{interpolate:{name:N.value}})),1)]),_:1})):(o(),f(m,{key:1,variant:"h1"}))]),content:S(()=>[b("div",{class:u(t.$style.grid)},[b("div",{class:u(t.$style.notice),"data-test-id":"info-callout"},[n.value?(o(),f(ue,{key:0,"app-credentials":a(e).appCredentials},null,8,["app-credentials"])):(o(),f(m,{key:1,variant:"p"}))],2),b("div",null,[n.value?(o(),A("ol",{key:0,class:u(t.$style.appCredentialsContainer)},[(o(!0),A(Q,null,X(a(e).credentialUsages,(p,F)=>(o(),f(ce,{key:p.key,class:u(t.$style.appCredential),order:F+1,credentials:p,"selected-credential-id":a(e).selectedCredentialIdByKey[p.key],onCredentialSelected:r[0]||(r[0]=v=>a(e).setSelectedCredentialId(v.credentialUsageKey,v.credentialId)),onCredentialDeselected:r[1]||(r[1]=v=>a(e).unsetSelectedCredential(v.credentialUsageKey))},null,8,["class","order","credentials","selected-credential-id"]))),128))],2)):(o(),A("div",{key:1,class:u(t.$style.appCredentialsContainer)},[g(m,{class:u(t.$style.appCredential),variant:"p",rows:3},null,8,["class"]),g(m,{class:u(t.$style.appCredential),variant:"p",rows:3},null,8,["class"])],2))]),b("div",{class:u(t.$style.actions)},[g(a(ne),{href:R.value,"new-window":!1,onClick:r[2]||(r[2]=p=>P(p))},{default:S(()=>[O(V(a(d).baseText("templateSetup.skip")),1)]),_:1},8,["href"]),n.value?(o(),f(T,{key:0,content:a(d).baseText("templateSetup.continue.button.fillRemaining"),disabled:a(e).numFilledCredentials>0},{default:S(()=>[g(h,{size:"large",label:a(d).baseText("templateSetup.continue.button"),disabled:a(e).isSaving||a(e).numFilledCredentials===0,"data-test-id":"continue-button",onClick:r[3]||(r[3]=p=>a(e).createWorkflow({router:a(i)}))},null,8,["label","disabled"])]),_:1},8,["content","disabled"])):(o(),A("div",we,[g(m,{variant:"button"})]))],2)],2)]),_:1})}}}),_e="_grid_1w212_5",ke="_notice_1w212_13",Te="_appCredentialsContainer_1w212_17",Ce="_appCredential_1w212_17",Se="_actions_1w212_28",ge={grid:_e,notice:ke,appCredentialsContainer:Te,appCredential:Ce,actions:Se},Ie={$style:ge},ot=ie(ve,[["__cssModules",Ie]]);export{ot as default};
//# sourceMappingURL=SetupWorkflowFromTemplateView-N8KkC4RI.js.map
