import{j as ie,H as re,c as ue,a as de}from"./index-xP-VuMjv.js";import{e as J,l as ee,f as ae,fR as te,t as se,x as le,_ as ne,u as ce,fS as be,a6 as ve,O as pe}from"./n8n-_nNvRoCf.js";import{R as me}from"./ResourcesListLayout--pg3flTX.js";import{G as oe,r as T,e as R,b as fe,d as ye,ag as U,l as r,m as g,p as k,R as c,M,u as n,T as _,O as l,S as h,I as z,Q,n as Y,D as _e,y as ke,a9 as ge}from"./vendor-NNwioulI.js";import"./pinia-aUqqC48i.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./lodash-es-5z_C16pm.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./uuid-McvpxQtQ.js";import"./luxon-ZRIU05qF.js";import"./esprima-next-ulPLCZ1Z.js";import"./@vueuse/core-8g26_cc0.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";const Te={class:"variables-key-column"},xe={key:0},Ce={class:"variables-value-column"},he={key:0},we={class:"variables-usage-column"},Ve={key:0},$e=oe({__name:"VariablesRow",props:{data:{type:Object,default:()=>({})},editing:{type:Boolean,default:!1}},emits:["save","cancel","edit","delete"],setup(w,{emit:E}){const p=w,o=le(),N=ie(),{showMessage:G}=J(),d=ee(),H=ae(),x=te(H.currentUser),i=T({...p.data}),b=T({key:!1,value:!1}),F=R(()=>b.value.key&&b.value.value),t=T(),V=T(),A=T(`$vars.${p.data.key}`),v=R(()=>d.isEnterpriseFeatureEnabled(se.Variables));R(()=>v.value&&(x.edit||x.delete)),fe(()=>{j()});const B=[{name:"REQUIRED"},{name:"MAX_LENGTH",config:{maximum:50}},{name:"MATCH_REGEX",config:{regex:/^[a-zA-Z]/,message:o.baseText("variables.editing.key.error.startsWithLetter")}},{name:"MATCH_REGEX",config:{regex:/^[a-zA-Z][a-zA-Z0-9_]*$/,message:o.baseText("variables.editing.key.error.jsonKey")}}],P=[{name:"MAX_LENGTH",config:{maximum:220}}];ye(()=>i.value.key,async()=>{await Y(),b.value.key&&C()});function C(){A.value=`$vars.${i.value.key||p.data.key}`}async function m(){i.value={...p.data},E("cancel",i.value)}async function L(){E("save",i.value)}async function X(){E("edit",i.value),await Y(),j()}async function q(){E("delete",i.value)}function I(u,s){b.value[u]=s}function W(){N.copy(A.value),G({title:o.baseText("variables.row.usage.copiedToClipboard"),type:"success"})}function j(){var u,s,$;($=(s=(u=t.value)==null?void 0:u.inputRef)==null?void 0:s.focus)==null||$.call(s)}return(u,s)=>{const $=U("n8n-form-input"),S=U("n8n-tooltip"),f=U("n8n-button");return r(),g("tr",{class:z(u.$style.variablesRow),"data-test-id":"variables-row"},[k("td",Te,[k("div",null,[w.editing?(r(),M($,{key:1,ref_key:"keyInputRef",ref:t,modelValue:i.value.key,"onUpdate:modelValue":s[0]||(s[0]=e=>i.value.key=e),label:"",name:"key","data-test-id":"variable-row-key-input",placeholder:n(o).baseText("variables.editing.key.placeholder"),required:"","validate-on-blur":"","validation-rules":B,onValidate:s[1]||(s[1]=e=>I("key",e))},null,8,["modelValue","placeholder"])):(r(),g("span",xe,c(w.data.key),1))])]),k("td",Ce,[k("div",null,[w.editing?(r(),M($,{key:1,ref_key:"valueInputRef",ref:V,modelValue:i.value.value,"onUpdate:modelValue":s[2]||(s[2]=e=>i.value.value=e),label:"",name:"value","data-test-id":"variable-row-value-input",placeholder:n(o).baseText("variables.editing.value.placeholder"),"validate-on-blur":"","validation-rules":P,onValidate:s[3]||(s[3]=e=>I("value",e))},null,8,["modelValue","placeholder"])):(r(),g("span",he,c(w.data.value),1))])]),k("td",we,[k("div",null,[_(S,{placement:"top"},{content:l(()=>[h(c(n(o).baseText("variables.row.usage.copyToClipboard")),1)]),default:l(()=>[i.value.key&&A.value?(r(),g("span",{key:0,class:z(u.$style.usageSyntax),onClick:W},c(A.value),3)):Q("",!0)]),_:1})])]),v.value?(r(),g("td",Ve,[w.editing?(r(),g("div",{key:0,class:z(u.$style.buttons)},[_(f,{"data-test-id":"variable-row-cancel-button",type:"tertiary",class:"mr-xs",onClick:m},{default:l(()=>[h(c(n(o).baseText("variables.row.button.cancel")),1)]),_:1}),_(f,{"data-test-id":"variable-row-save-button",disabled:!F.value,type:"primary",onClick:L},{default:l(()=>[h(c(n(o).baseText("variables.row.button.save")),1)]),_:1},8,["disabled"])],2)):(r(),g("div",{key:1,class:z([u.$style.buttons,u.$style.hoverButtons])},[_(S,{disabled:n(x).edit,placement:"top"},{content:l(()=>[h(c(n(o).baseText("variables.row.button.edit.onlyOwnerCanSave")),1)]),default:l(()=>[k("div",null,[_(f,{"data-test-id":"variable-row-edit-button",type:"tertiary",class:"mr-xs",disabled:!n(x).edit,onClick:X},{default:l(()=>[h(c(n(o).baseText("variables.row.button.edit")),1)]),_:1},8,["disabled"])])]),_:1},8,["disabled"]),_(S,{disabled:n(x).delete,placement:"top"},{content:l(()=>[h(c(n(o).baseText("variables.row.button.delete.onlyOwnerCanDelete")),1)]),default:l(()=>[k("div",null,[_(f,{"data-test-id":"variable-row-delete-button",type:"tertiary",disabled:!n(x).delete,onClick:q},{default:l(()=>[h(c(n(o).baseText("variables.row.button.delete")),1)]),_:1},8,["disabled"])])]),_:1},8,["disabled"])],2))])):Q("",!0)],2)}}}),Se="_variablesRow_rbd77_5",Re="_hoverButtons_rbd77_5",Ee="_buttons_rbd77_14",Ae="_usageSyntax_rbd77_25",Be={variablesRow:Se,hoverButtons:Re,buttons:Ee,usageSyntax:Ae},Me={$style:Be},Ue=ne($e,[["__cssModules",Me]]),Ie={key:0},Oe={key:1},D="@tmpvar",De=oe({__name:"VariablesView",setup(w){const E=ee(),p=re(),o=ae(),N=ce(),G=pe(),d=le(),H=de(),x=ue();let i=()=>{};const b=T(null),{showError:F}=J(),t=T([]),V=T({}),A=te(o.currentUser),v=R(()=>E.isEnterpriseFeatureEnabled(se.Variables)),B=R(()=>v.value&&A.create),P=R(()=>[{id:0,path:"name",label:d.baseText("variables.table.key"),classes:["variables-key-column"]},{id:1,path:"value",label:d.baseText("variables.table.value"),classes:["variables-value-column"]},{id:2,path:"usage",label:d.baseText("variables.table.usage"),classes:["variables-usage-column"]},...v.value?[{id:3,path:"actions",label:""}]:[]]),C=R(()=>N.contextBasedTranslationKeys),m=T([]),L=(e,a,y)=>`${e.id}`.startsWith(D)?-1:`${a.id}`.startsWith(D)?1:m.value.includes(e.id)&&m.value.includes(a.id)?m.value.indexOf(e.id)-m.value.indexOf(a.id):m.value.includes(e.id)?-1:m.value.includes(a.id)?1:y==="asc"?f(e).trim().localeCompare(f(a).trim()):f(a).trim().localeCompare(f(e).trim()),X={nameAsc:(e,a)=>L(e,a,"asc"),nameDesc:(e,a)=>L(e,a,"desc")};function q(){m.value=[]}async function I(){await p.fetchAllVariables(),t.value=[...p.variables]}function W(){const e={id:be(D),key:"",value:""};b.value&&(b.value.$refs.listWrapperRef&&(b.value.$refs.listWrapperRef.scrollTop=0),b.value.currentPage!==1&&b.value.setCurrentPage(1)),t.value.unshift(e),V.value[e.id]=!0,G.track("User clicked add variable button")}async function j(e){let a;try{if(typeof e.id=="string"&&e.id.startsWith(D)){const{id:y,...K}=e;a=await p.createVariable(K),t.value.unshift(a),t.value=t.value.filter(O=>O.id!==e.id),m.value.unshift(a.id)}else a=await p.updateVariable(e),t.value=t.value.filter(y=>y.id!==e.id),t.value.push(a),u(a)}catch(y){F(y,d.baseText("variables.errors.save"))}}function u(e){V.value={...V.value,[e.id]:!V.value[e.id]}}function s(e){typeof e.id=="string"&&e.id.startsWith(D)?t.value=t.value.filter(a=>a.id!==e.id):u(e)}async function $(e){try{if(await H.confirm(d.baseText("variables.modals.deleteConfirm.message",{interpolate:{name:e.key}}),d.baseText("variables.modals.deleteConfirm.title"),{confirmButtonText:d.baseText("variables.modals.deleteConfirm.confirmButton"),cancelButtonText:d.baseText("variables.modals.deleteConfirm.cancelButton")})!==ve)return;await p.deleteVariable(e),t.value=t.value.filter(y=>y.id!==e.id)}catch(a){F(a,d.baseText("variables.errors.delete"))}}function S(){N.goToUpgrade("variables","upgrade-variables")}function f(e){return e.key}return _e(()=>{i=x.$onAction(({name:e,after:a})=>{e==="pullWorkfolder"&&a&&a(()=>{I()})})}),ke(()=>{i()}),(e,a)=>{const y=U("n8n-button"),K=U("n8n-tooltip"),O=U("n8n-action-box");return r(),M(me,{ref_key:"layoutRef",ref:b,class:"variables-view","resource-key":"variables",disabled:!v.value,resources:t.value,initialize:I,shareable:!1,"display-name":f,"sort-fns":X,"sort-options":["nameAsc","nameDesc"],"show-filters-dropdown":!1,type:"datatable","type-props":{columns:P.value},onSort:q,"onClick:add":W},ge({"add-button":l(()=>[_(K,{placement:"top",disabled:B.value},{content:l(()=>[v.value?(r(),g("span",Oe,c(n(d).baseText("variables.add.onlyOwnerCanCreate")),1)):(r(),g("span",Ie,c(n(d).baseText(`variables.add.unavailable${t.value.length===0?".empty":""}`)),1))]),default:l(()=>[k("div",null,[_(y,{size:"large",block:"",disabled:!B.value,"data-test-id":"resources-list-add",onClick:W},{default:l(()=>[h(c(e.$locale.baseText("variables.add")),1)]),_:1},8,["disabled"])])]),_:1},8,["disabled"])]),default:l(({data:Z})=>[(r(),M(Ue,{key:Z.id,editing:V.value[Z.id],data:Z,onSave:j,onEdit:u,onCancel:s,onDelete:$},null,8,["editing","data"]))]),_:2},[v.value?void 0:{name:"preamble",fn:l(()=>[_(O,{class:"mb-m","data-test-id":"unavailable-resources-list",emoji:"ðŸ‘‹",heading:e.$locale.baseText(C.value.variables.unavailable.title),description:e.$locale.baseText(C.value.variables.unavailable.description),"button-text":e.$locale.baseText(C.value.variables.unavailable.button),"button-type":"secondary","onClick:button":S},null,8,["heading","description","button-text"])]),key:"0"},!v.value||v.value&&!B.value?{name:"empty",fn:l(()=>[v.value?B.value?Q("",!0):(r(),M(O,{key:1,"data-test-id":"cannot-create-variables",emoji:"ðŸ‘‹",heading:e.$locale.baseText("variables.empty.notAllowedToCreate.heading",{interpolate:{name:n(o).currentUser.firstName}}),description:e.$locale.baseText("variables.empty.notAllowedToCreate.description"),onClick:S},null,8,["heading","description"])):(r(),M(O,{key:0,"data-test-id":"unavailable-resources-list",emoji:"ðŸ‘‹",heading:e.$locale.baseText(C.value.variables.unavailable.title),description:e.$locale.baseText(C.value.variables.unavailable.description),"button-text":e.$locale.baseText(C.value.variables.unavailable.button),"button-type":"secondary","onClick:button":S},null,8,["heading","description","button-text"]))]),key:"1"}:void 0]),1032,["disabled","resources","type-props"])}}}),Ne="_sidebarContainer_1qflh_9",Fe={"type-input":"_type-input_1qflh_5",sidebarContainer:Ne},Le={$style:Fe},fa=ne(De,[["__cssModules",Le],["__scopeId","data-v-ea707e68"]]);export{fa as default};
//# sourceMappingURL=VariablesView-f2HGzjfU.js.map
