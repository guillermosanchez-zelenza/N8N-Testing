import{R as J}from"./ResourcesListLayout--pg3flTX.js";import{e as X,t as K,v as H,f as B,u as F,l as j,Y as Z,dw as ee,V as L,dI as te,df as se,a6 as oe,_ as I,dz as ae,O as ne,B as re}from"./n8n-_nNvRoCf.js";import{aB as ie,a as le,T as de,u as ce,c as ue}from"./index-xP-VuMjv.js";import{W as me}from"./WorkflowActivator-cWuKXdhv.js";import{m as q}from"./pinia-aUqqC48i.js";import{G as M,ag as s,l as c,M as v,O as a,I as h,R as f,S as k,T as o,Q as U,a2 as pe,p as y,U as V,V as z,m as T,e as D,aJ as fe,F as N,a7 as P,u as he}from"./vendor-NNwioulI.js";import{T as ge}from"./TemplatesInfoCarousel-FOroCegN.js";import"./lodash-es-5z_C16pm.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./esprima-next-ulPLCZ1Z.js";import"./luxon-ZRIU05qF.js";import"./@vueuse/core-8g26_cc0.js";import"./uuid-McvpxQtQ.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";import"./workflowActivate-taS2Qpdq.js";import"./NodeList-_14w6OPV.js";import"./vue-agile-opIkBolK.js";const $={OPEN:"open",SHARE:"share",DUPLICATE:"duplicate",DELETE:"delete"},we=M({components:{TimeAgo:ie,WorkflowActivator:me},props:{data:{type:Object,required:!0,default:()=>({id:"",createdAt:"",updatedAt:"",active:!1,connections:{},nodes:[],name:"",sharedWith:[],ownedBy:{},versionId:""})},readOnly:{type:Boolean,default:!1}},setup(){return{...X(),...le()}},data(){return{EnterpriseEditionFeature:K}},computed:{...q(j,F,B,H),currentUser(){return this.usersStore.currentUser||{}},workflowPermissions(){return Z(this.currentUser,this.data)},actions(){const e=[{label:this.$locale.baseText("workflows.item.open"),value:$.OPEN},{label:this.$locale.baseText("workflows.item.share"),value:$.SHARE}];return this.readOnly||e.push({label:this.$locale.baseText("workflows.item.duplicate"),value:$.DUPLICATE}),this.workflowPermissions.delete&&!this.readOnly&&e.push({label:this.$locale.baseText("workflows.item.delete"),value:$.DELETE}),e},formattedCreatedAtDate(){const e=new Date().getFullYear();return ee(this.data.createdAt,`d mmmm${this.data.createdAt.startsWith(e)?"":", yyyy"}`)}},methods:{async onClick(e){var t;if(!(this.$refs.cardActions===e.target||(t=this.$refs.cardActions)!=null&&t.contains(e.target))){if(e.metaKey||e.ctrlKey){const r=this.$router.resolve({name:L.WORKFLOW,params:{name:this.data.id}});window.open(r.href,"_blank");return}await this.$router.push({name:L.WORKFLOW,params:{name:this.data.id}})}},onClickTag(e,t){t.stopPropagation(),this.$emit("click:tag",e,t)},onExpandTags(){this.$emit("expand:tags")},async onAction(e){if(e===$.OPEN)await this.onClick();else if(e===$.DUPLICATE)this.uiStore.openModalWithData({name:te,data:{id:this.data.id,name:this.data.name,tags:(this.data.tags||[]).map(t=>t.id)}});else if(e===$.SHARE)this.uiStore.openModalWithData({name:se,data:{id:this.data.id}}),this.$telemetry.track("User opened sharing modal",{workflow_id:this.data.id,user_id_sharer:this.currentUser.id,sub_view:this.$route.name===L.WORKFLOWS?"Workflows listing":"Workflow editor"});else if(e===$.DELETE){if(await this.confirm(this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.message",{interpolate:{workflowName:this.data.name}}),this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.headline"),{type:"warning",confirmButtonText:this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.confirmButtonText"),cancelButtonText:this.$locale.baseText("mainSidebar.confirmMessage.workflowDelete.cancelButtonText")})!==oe)return;try{await this.workflowsStore.deleteWorkflow(this.data.id)}catch(r){this.showError(r,this.$locale.baseText("generic.deleteWorkflowError"));return}this.showMessage({title:this.$locale.baseText("mainSidebar.showMessage.handleSelect1.title"),type:"success"})}}}}),ke="_cardLink_523op_5",ye="_cardHeading_523op_15",be="_cardDescription_523op_21",_e="_cardActions_523op_28",Te={cardLink:ke,cardHeading:ye,cardDescription:be,cardActions:_e},Se={key:0};function $e(e,t,r,d,p,i){const l=s("n8n-heading"),u=s("TimeAgo"),m=s("n8n-tags"),E=s("n8n-text"),n=s("n8n-badge"),b=s("enterprise-edition"),g=s("WorkflowActivator"),S=s("n8n-action-toggle"),A=s("n8n-card");return c(),v(A,{class:h(e.$style.cardLink),onClick:e.onClick},{header:a(()=>[o(l,{tag:"h2",bold:"",class:h(e.$style.cardHeading),"data-test-id":"workflow-card-name"},{default:a(()=>[k(f(e.data.name),1)]),_:1},8,["class"])]),append:a(()=>[y("div",{ref:"cardActions",class:h(e.$style.cardActions)},[o(b,{features:[e.EnterpriseEditionFeature.Sharing]},{default:a(()=>[e.workflowPermissions.isOwner?(c(),v(n,{key:0,class:"mr-xs",theme:"tertiary",bold:""},{default:a(()=>[k(f(e.$locale.baseText("workflows.item.owner")),1)]),_:1})):U("",!0)]),_:1},8,["features"]),o(g,{class:"mr-s","workflow-active":e.data.active,"workflow-id":e.data.id,"data-test-id":"workflow-card-activator"},null,8,["workflow-active","workflow-id"]),o(S,{actions:e.actions,theme:"dark","data-test-id":"workflow-card-actions",onAction:e.onAction,onClick:t[0]||(t[0]=pe(()=>{},["stop"]))},null,8,["actions","onAction"])],2)]),default:a(()=>[y("div",{class:h(e.$style.cardDescription)},[o(E,{color:"text-light",size:"small"},{default:a(()=>[z(y("span",null,[k(f(e.$locale.baseText("workflows.item.updated"))+" ",1),o(u,{date:e.data.updatedAt},null,8,["date"]),k(" | ")],512),[[V,e.data]]),z(y("span",{class:"mr-2xs"},f(e.$locale.baseText("workflows.item.created"))+" "+f(e.formattedCreatedAtDate),513),[[V,e.data]]),e.settingsStore.areTagsEnabled&&e.data.tags&&e.data.tags.length>0?z((c(),T("span",Se,[o(m,{tags:e.data.tags,"truncate-at":3,truncate:"","data-test-id":"workflow-card-tags","onClick:tag":e.onClickTag,onExpand:e.onExpandTags},null,8,["tags","onClick:tag","onExpand"])],512)),[[V,e.data]]):U("",!0)]),_:1})],2)]),_:1},8,["class","onClick"])}const Ce={$style:Te},ve=I(we,[["render",$e],["__cssModules",Ce]]),Ee=M({__name:"SuggestedTemplatesSection",props:{section:{type:Object,required:!0},title:{type:String,required:!1},showTitle:{type:Boolean,default:!0}},setup(e){const t=e,r=F(),d=ne(),p=D(()=>{const l=Array();return r.suggestedTemplates&&t.section.workflows.forEach((u,m)=>{l.push({id:m,name:u.title,workflows:[{id:m}],nodes:u.nodes})}),l});function i({id:l}){r.openModalWithData({name:ae,data:{workflow:t.section.workflows[l]}}),d.track("User clicked template recommendation",{templateName:t.section.workflows[l].title},{withPostHog:!0})}return(l,u)=>{const m=s("n8n-text");return c(),T("div",{class:h(l.$style.container),"data-test-id":"suggested-templates-section-container"},[e.showTitle?(c(),T("div",{key:0,class:h(l.$style.header)},[o(m,{size:"large",color:"text-base",bold:!0},{default:a(()=>[k(f(t.title??e.section.title),1)]),_:1})],2)):U("",!0),y("div",{class:h(l.$style.content)},[o(ge,{collections:p.value,loading:!1,"show-item-count":!1,"show-navigation":!1,"cards-width":"24%",onOpenCollection:i},null,8,["collections"])],2)],2)}}}),We="_container_a9sun_5",Ae={container:We},Oe={$style:Ae},Y=I(Ee,[["__cssModules",Oe]]),Le=M({__name:"SuggestedTemplatesPage",setup(e,{expose:t}){const r=B(),d=F(),p=fe(),i=D(()=>r.currentUser),l=n=>{var b,g,S;if(n!=null&&n.firstName)return((g=(b=n.firstName)==null?void 0:b.charAt(0))==null?void 0:g.toUpperCase())+((S=n==null?void 0:n.firstName)==null?void 0:S.slice(1))},u=D(()=>d.suggestedTemplates?d.suggestedTemplates.sections[0]:null),m=D(()=>{const n=Array();return!d.suggestedTemplates||!u.value||u.value.workflows.forEach((b,g)=>{n.push({id:g,name:b.title,workflows:[{id:g}],nodes:b.nodes})}),n});function E(){d.nodeViewInitialized=!1,p.push({name:L.NEW_WORKFLOW})}return t({currentUser:i,openCanvas:E,suggestedTemplates:m}),(n,b)=>{var O;const g=s("n8n-heading"),S=s("n8n-text"),A=s("n8n-button");return c(),T("div",{class:h(n.$style.container),"data-test-id":"suggested-templates-page-container"},[y("div",{class:h(n.$style.header)},[o(g,{tag:"h1",size:"2xlarge",class:"mb-2xs"},{default:a(()=>[k(f(n.$locale.baseText("suggestedTemplates.heading",{interpolate:{name:l(i.value)||n.$locale.baseText("generic.welcome")}})),1)]),_:1}),o(S,{size:"large",color:"text-base","data-test-id":"suggested-template-section-description"},{default:a(()=>{var C;return[k(f((C=u.value)==null?void 0:C.description),1)]}),_:1})],2),y("div",{class:h(n.$style.content)},[(c(!0),T(N,null,P((O=he(d).suggestedTemplates)==null?void 0:O.sections,C=>(c(),v(Y,{key:C.title,section:C,"show-title":!1},null,8,["section"]))),128))],2),y("div",null,[o(A,{label:n.$locale.baseText("suggestedTemplates.newWorkflowButton"),type:"secondary",size:"medium",icon:"plus","data-test-id":"suggested-templates-new-workflow-button",onClick:E},null,8,["label"])])],2)}}}),Ue="_container_to7oy_5",De="_header_to7oy_11",Fe={container:Ue,header:De},Ie={$style:Fe},Me=I(Le,[["__cssModules",Ie]]),W={ACTIVE:!0,DEACTIVATED:!1,ALL:""},Ve=M({name:"WorkflowsView",components:{ResourcesListLayout:J,WorkflowCard:ve,TagsDropdown:de,SuggestedTemplatesPage:Me,SuggestedTemplatesSection:Y},data(){return{filters:{search:"",ownedBy:"",sharedWith:"",status:W.ALL,tags:[]},sourceControlStoreUnsubscribe:()=>{}}},computed:{...q(j,F,B,H,re,ue,ce),readOnlyEnv(){return this.sourceControlStore.preferences.branchReadOnly},currentUser(){return this.usersStore.currentUser||{}},allWorkflows(){return this.workflowsStore.allWorkflows},isShareable(){return this.settingsStore.isEnterpriseFeatureEnabled(K.Sharing)},statusFilterOptions(){return[{label:this.$locale.baseText("workflows.filters.status.all"),value:W.ALL},{label:this.$locale.baseText("workflows.filters.status.active"),value:W.ACTIVE},{label:this.$locale.baseText("workflows.filters.status.deactivated"),value:W.DEACTIVATED}]},suggestedTemplates(){return this.uiStore.suggestedTemplates}},watch:{"filters.tags"(){this.sendFiltersTelemetry("tags")}},mounted(){this.setFiltersFromQueryString(),this.usersStore.showPersonalizationSurvey(),this.sourceControlStoreUnsubscribe=this.sourceControlStore.$onAction(({name:e,after:t})=>{e==="pullWorkfolder"&&t&&t(()=>{this.initialize()})})},beforeUnmount(){this.sourceControlStoreUnsubscribe()},methods:{onFiltersUpdated(e){this.filters=e,this.saveFiltersOnQueryString()},addWorkflow(){this.uiStore.nodeViewInitialized=!1,this.$router.push({name:L.NEW_WORKFLOW}),this.$telemetry.track("User clicked add workflow button",{source:"Workflows list"})},async initialize(){await Promise.all([this.usersStore.fetchUsers(),this.workflowsStore.fetchAllWorkflows(),this.workflowsStore.fetchActiveWorkflows(),this.credentialsStore.fetchAllCredentials()])},onClickTag(e,t){this.filters.tags.includes(e)||this.filters.tags.push(e)},onFilter(e,t,r){return this.settingsStore.areTagsEnabled&&t.tags.length>0&&(r=r&&t.tags.every(d=>{var p;return(p=e.tags)==null?void 0:p.find(i=>typeof i=="object"?`${i.id}`==`${d}`:`${i}`==`${d}`)})),t.status!==""&&(r=r&&e.active===t.status),r},sendFiltersTelemetry(e){this.$refs.layout.sendFiltersTelemetry(e)},saveFiltersOnQueryString(){const e={};this.filters.search&&(e.search=this.filters.search),typeof this.filters.status!="string"&&(e.status=this.filters.status.toString()),this.filters.tags.length&&(e.tags=this.filters.tags.join(",")),this.filters.ownedBy&&(e.ownedBy=this.filters.ownedBy),this.filters.sharedWith&&(e.sharedWith=this.filters.sharedWith),this.$router.replace({query:Object.keys(e).length?e:void 0})},isValidUserId(e){return Object.keys(this.usersStore.users).includes(e)},setFiltersFromQueryString(){const{tags:e,status:t,search:r,ownedBy:d,sharedWith:p}=this.$route.query,i={};if(d&&typeof d=="string"&&this.isValidUserId(d)&&(i.ownedBy=d),p&&typeof p=="string"&&this.isValidUserId(p)&&(i.sharedWith=p),r&&typeof r=="string"&&(i.search=r),e&&typeof e=="string"){const l=this.tagsStore.allTags.map(m=>m.id),u=e.split(",").filter(m=>l.includes(m));u.length&&(i.tags=u)}t&&typeof t=="string"&&[W.ACTIVE.toString(),W.DEACTIVATED.toString()].includes(t)&&(i.status=t==="true"),Object.keys(i).length&&(this.filters={...this.filters,...i})}}}),ze=Ve,Ne="_actionsContainer_51pcb_5",Pe="_emptyStateCard_51pcb_10",Be="_emptyStateCardIcon_51pcb_23",Re={actionsContainer:Ne,emptyStateCard:Pe,emptyStateCardIcon:Be},Ke={key:1},He={class:"text-center mt-s"},je={key:0,class:"mb-s"},qe={class:"mb-s"};function Ye(e,t,r,d,p,i){const l=s("n8n-button"),u=s("n8n-tooltip"),m=s("WorkflowCard"),E=s("SuggestedTemplatesSection"),n=s("SuggestedTemplatesPage"),b=s("n8n-heading"),g=s("n8n-text"),S=s("n8n-icon"),A=s("n8n-card"),O=s("n8n-input-label"),C=s("TagsDropdown"),Q=s("n8n-option"),x=s("n8n-select"),G=s("ResourcesListLayout");return c(),v(G,{ref:"layout","resource-key":"workflows",resources:e.allWorkflows,filters:e.filters,"additional-filters-handler":e.onFilter,"type-props":{itemSize:80},"show-aside":e.allWorkflows.length>0,shareable:e.isShareable,initialize:e.initialize,disabled:e.readOnlyEnv,"onClick:add":e.addWorkflow,"onUpdate:filters":e.onFiltersUpdated},{"add-button":a(({disabled:_})=>[o(u,{disabled:!e.readOnlyEnv},{content:a(()=>[k(f(e.$locale.baseText("mainSidebar.workflows.readOnlyEnv.tooltip")),1)]),default:a(()=>[y("div",null,[o(l,{size:"large",block:"",disabled:_,"data-test-id":"resources-list-add",onClick:e.addWorkflow},{default:a(()=>[k(f(e.$locale.baseText("workflows.add")),1)]),_:2},1032,["disabled","onClick"])])]),_:2},1032,["disabled"])]),default:a(({data:_,updateItemSize:w})=>[o(m,{"data-test-id":"resources-list-item",class:"mb-2xs",data:_,"read-only":e.readOnlyEnv,"onExpand:tags":R=>w(_),"onClick:tag":e.onClickTag},null,8,["data","read-only","onExpand:tags","onClick:tag"])]),postListContent:a(()=>{var _;return[(c(!0),T(N,null,P((_=e.suggestedTemplates)==null?void 0:_.sections,(w,R)=>(c(),v(E,{key:R,section:w,title:e.$locale.baseText("suggestedTemplates.sectionTitle",{interpolate:{sectionName:w.name.toLocaleLowerCase()}})},null,8,["section","title"]))),128))]}),empty:a(()=>[e.suggestedTemplates?(c(),v(n,{key:0})):(c(),T("div",Ke,[y("div",He,[o(b,{tag:"h2",size:"xlarge",class:"mb-2xs"},{default:a(()=>[k(f(e.$locale.baseText(e.currentUser.firstName?"workflows.empty.heading":"workflows.empty.heading.userNotSetup",{interpolate:{name:e.currentUser.firstName}})),1)]),_:1}),o(g,{size:"large",color:"text-base"},{default:a(()=>[k(f(e.$locale.baseText(e.readOnlyEnv?"workflows.empty.description.readOnlyEnv":"workflows.empty.description")),1)]),_:1})]),e.readOnlyEnv?U("",!0):(c(),T("div",{key:0,class:h(["text-center","mt-2xl",e.$style.actionsContainer])},[o(A,{class:h(e.$style.emptyStateCard),hoverable:"","data-test-id":"new-workflow-card",onClick:e.addWorkflow},{default:a(()=>[o(S,{class:h(e.$style.emptyStateCardIcon),icon:"file"},null,8,["class"]),o(g,{size:"large",class:"mt-xs",color:"text-base"},{default:a(()=>[k(f(e.$locale.baseText("workflows.empty.startFromScratch")),1)]),_:1})]),_:1},8,["class","onClick"])],2))]))]),filters:a(({setKeyValue:_})=>[e.settingsStore.areTagsEnabled?(c(),T("div",je,[o(O,{label:e.$locale.baseText("workflows.filters.tags"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),o(C,{placeholder:e.$locale.baseText("workflowOpen.filterWorkflows"),"model-value":e.filters.tags,"create-enabled":!1,"onUpdate:modelValue":w=>_("tags",w)},null,8,["placeholder","model-value","onUpdate:modelValue"])])):U("",!0),y("div",qe,[o(O,{label:e.$locale.baseText("workflows.filters.status"),bold:!1,size:"small",color:"text-base",class:"mb-3xs"},null,8,["label"]),o(x,{"data-test-id":"status-dropdown","model-value":e.filters.status,"onUpdate:modelValue":w=>_("status",w)},{default:a(()=>[(c(!0),T(N,null,P(e.statusFilterOptions,w=>(c(),v(Q,{key:w.label,label:w.label,value:w.value,"data-test-id":"status"},null,8,["label","value"]))),128))]),_:2},1032,["model-value","onUpdate:modelValue"])])]),_:1},8,["resources","filters","additional-filters-handler","show-aside","shareable","initialize","disabled","onClick:add","onUpdate:filters"])}const Qe={$style:Re},At=I(ze,[["render",Ye],["__cssModules",Qe]]);export{At as default};
//# sourceMappingURL=WorkflowsView-nUMc06Bo.js.map
