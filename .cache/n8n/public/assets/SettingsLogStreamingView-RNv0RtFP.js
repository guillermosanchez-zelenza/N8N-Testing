import{m as N}from"./pinia-aUqqC48i.js";import{t as M,o as D,dr as T,a6 as z,_ as I,k as R,B as F,u as j,v as x,l as K,h as G,dp as A}from"./n8n-_nNvRoCf.js";import{a as q,az as O}from"./index-xP-VuMjv.js";import{G as W,ag as a,l as s,M as g,O as o,p as n,T as r,S,R as m,I as c,n as Q,m as l,F as v,Q as _,a7 as Y}from"./vendor-NNwioulI.js";import{v as J}from"./uuid-McvpxQtQ.js";import"./lodash-es-5z_C16pm.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./esprima-next-ulPLCZ1Z.js";import"./luxon-ZRIU05qF.js";import"./@vueuse/core-8g26_cc0.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";const y={OPEN:"open",DELETE:"delete"},X=W({components:{},setup(){return{...q()}},data(){return{EnterpriseEditionFeature:M,nodeParameters:{}}},props:{eventBus:{type:Object},destination:{type:Object,required:!0,default:D(T)},readonly:Boolean},mounted(){var e;this.nodeParameters=Object.assign(D(T),this.destination),(e=this.eventBus)==null||e.on("destinationWasSaved",this.onDestinationWasSaved)},beforeUnmount(){var e;(e=this.eventBus)==null||e.off("destinationWasSaved",this.onDestinationWasSaved)},computed:{...N(O),actions(){const e=[{label:this.$locale.baseText("workflows.item.open"),value:y.OPEN}];return this.readonly||e.push({label:this.$locale.baseText("workflows.item.delete"),value:y.DELETE}),e},typeLabelName(){return`settings.log-streaming.${this.destination.__type}`}},methods:{onDestinationWasSaved(){this.logStreamingStore.getDestination(this.destination.id)&&(this.nodeParameters=Object.assign(D(T),this.destination))},async onClick(e){var t,i;this.$refs.cardActions===e.target||(t=this.$refs.cardActions)!=null&&t.contains(e.target)||(i=e.target)!=null&&i.contains(this.$refs.cardActions)||this.$emit("edit",this.destination.id)},onEnabledSwitched(e,t){this.nodeParameters.enabled=e,this.saveDestination()},async saveDestination(){await this.logStreamingStore.saveDestination(this.nodeParameters)},async onAction(e){if(e===y.OPEN)this.$emit("edit",this.destination.id);else if(e===y.DELETE){if(await this.confirm(this.$locale.baseText("settings.log-streaming.destinationDelete.message",{interpolate:{destinationName:this.destination.label}}),this.$locale.baseText("settings.log-streaming.destinationDelete.headline"),{type:"warning",confirmButtonText:this.$locale.baseText("settings.log-streaming.destinationDelete.confirmButtonText"),cancelButtonText:this.$locale.baseText("settings.log-streaming.destinationDelete.cancelButtonText")})!==z)return;this.$emit("remove",this.destination.id)}}}}),Z="_cardLink_ump6w_5",ee="_activeStatusText_ump6w_15",te="_cardHeading_ump6w_23",ne="_cardDescription_ump6w_29",se="_cardActions_ump6w_36",oe={cardLink:Z,activeStatusText:ee,cardHeading:te,cardDescription:ne,cardActions:se};function ie(e,t,i,u,H,P){const k=a("n8n-heading"),h=a("n8n-text"),b=a("el-switch"),$=a("n8n-action-toggle"),w=a("n8n-card");return s(),g(w,{class:c(e.$style.cardLink),"data-test-id":"destination-card",onClick:e.onClick},{header:o(()=>[n("div",null,[r(k,{tag:"h2",bold:"",class:c(e.$style.cardHeading)},{default:o(()=>[S(m(e.destination.label),1)]),_:1},8,["class"]),n("div",{class:c(e.$style.cardDescription)},[r(h,{color:"text-light",size:"small"},{default:o(()=>[n("span",null,m(e.$locale.baseText(e.typeLabelName)),1)]),_:1})],2)])]),append:o(()=>[n("div",{ref:"cardActions",class:c(e.$style.cardActions)},[n("div",{class:c(e.$style.activeStatusText),"data-test-id":"destination-activator-status"},[e.nodeParameters.enabled?(s(),g(h,{key:0,color:"success",size:"small",bold:""},{default:o(()=>[S(m(e.$locale.baseText("workflowActivator.active")),1)]),_:1})):(s(),g(h,{key:1,color:"text-base",size:"small",bold:""},{default:o(()=>[S(m(e.$locale.baseText("workflowActivator.inactive")),1)]),_:1}))],2),r(b,{class:"mr-s",disabled:e.readonly,"model-value":e.nodeParameters.enabled,title:e.nodeParameters.enabled?e.$locale.baseText("workflowActivator.deactivateWorkflow"):e.$locale.baseText("workflowActivator.activateWorkflow"),"active-color":"#13ce66","inactive-color":"#8899AA","data-test-id":"workflow-activate-switch","onUpdate:modelValue":t[0]||(t[0]=L=>e.onEnabledSwitched(L,e.destination.id))},null,8,["disabled","model-value","title"]),r($,{actions:e.actions,theme:"dark",onAction:e.onAction},null,8,["actions","onAction"])],2)]),_:1},8,["class","onClick"])}const ae={$style:oe},re=I(X,[["render",ie],["__cssModules",ae]]),le=W({name:"SettingsLogStreamingView",components:{EventDestinationCard:re},props:{},data(){return{eventBus:R(),destinations:Array,disableLicense:!1,allDestinations:[]}},async mounted(){this.isLicensed&&(await this.credentialsStore.fetchCredentialTypes(!1),await this.credentialsStore.fetchAllCredentials(),this.uiStore.nodeViewInitialized=!1,await this.getDestinationDataFromBackend(),this.logStreamingStore.$onAction(({name:e,after:t})=>{(e==="removeDestination"||e==="updateDestination")&&t(async()=>{this.$forceUpdate()})}),this.eventBus.on("destinationWasSaved",this.onDestinationWasSaved),this.eventBus.on("remove",this.onRemove),this.eventBus.on("closing",this.onBusClosing))},beforeUnmount(){this.eventBus.off("destinationWasSaved",this.onDestinationWasSaved),this.eventBus.off("remove",this.onRemove),this.eventBus.off("closing",this.onBusClosing)},computed:{...N(K,O,x,j,F),sortedItemKeysByLabel(){var t;const e=[];for(const[i,u]of Object.entries(this.logStreamingStore.items))e.push({key:i,label:((t=u.destination)==null?void 0:t.label)??"Destination"});return e.sort((i,u)=>i.label.localeCompare(u.label))},environment(){return"production"},isLicensed(){return this.disableLicense?!1:this.settingsStore.isEnterpriseFeatureEnabled(M.LogStreaming)},canManageLogStreaming(){return G(["rbac"],{rbac:{scope:"logStreaming:manage"}})}},methods:{onDestinationWasSaved(){this.$forceUpdate()},onBusClosing(){this.workflowsStore.removeAllNodes({setStateDirty:!1,removePinData:!0}),this.uiStore.stateIsDirty=!1},async getDestinationDataFromBackend(){this.logStreamingStore.clearEventNames(),this.logStreamingStore.clearDestinationItemTrees(),this.allDestinations=[];const e=await this.logStreamingStore.fetchEventNames();if(e)for(const i of e)this.logStreamingStore.addEventName(i);const t=await this.logStreamingStore.fetchDestinations();if(t)for(const i of t)this.logStreamingStore.addDestination(i),this.allDestinations.push(i);this.$forceUpdate()},goToUpgrade(){this.uiStore.goToUpgrade("log-streaming","upgrade-log-streaming")},storeHasItems(){return this.logStreamingStore.items&&Object.keys(this.logStreamingStore.items).length>0},async addDestination(){const e=D(T);e.id=J(),this.logStreamingStore.addDestination(e),await Q(),this.uiStore.openModalWithData({name:A,data:{destination:e,isNew:!0,eventBus:this.eventBus}})},async onRemove(e){if(!e)return;await this.logStreamingStore.deleteDestination(e);const t=this.workflowsStore.getNodeByName(e);t&&this.workflowsStore.removeNode(t)},async onEdit(e){if(!e)return;const t=this.logStreamingStore.getDestination(e);t&&this.uiStore.openModalWithData({name:A,data:{destination:t,isNew:!1,eventBus:this.eventBus}})}}}),de="_header_1lkg8_5",ce="_destinationItem_1lkg8_15",me={header:de,destinationItem:ce},ge={class:"mb-2xl"},ue={class:"ml-m"},he={class:"mb-l"},pe=["innerHTML"],fe={class:"mt-m text-right"},ve={key:1,"data-test-id":"action-box-licensed"},Se=["innerHTML"],be={key:0,class:"mb-l"},_e=["innerHTML"],ye={"data-test-id":"action-box-unlicensed"},De=["innerHTML"];function Te(e,t,i,u,H,P){const k=a("n8n-heading"),h=a("el-switch"),b=a("n8n-info-tip"),$=a("EventDestinationCard"),w=a("el-col"),L=a("el-row"),U=a("n8n-button"),B=a("n8n-action-box");return s(),l("div",null,[n("div",{class:c(e.$style.header)},[n("div",ge,[r(k,{size:"2xlarge"},{default:o(()=>[S(m(e.$locale.baseText("settings.log-streaming.heading")),1)]),_:1}),e.environment!=="production"?(s(),l(v,{key:0},[n("strong",ue,"Disable License ("+m(e.environment)+")Â ",1),r(h,{modelValue:e.disableLicense,"onUpdate:modelValue":t[0]||(t[0]=d=>e.disableLicense=d),size:"large","data-test-id":"disable-license-toggle"},null,8,["modelValue"])],64)):_("",!0)])],2),e.isLicensed?(s(),l(v,{key:0},[n("div",he,[r(b,{theme:"info",type:"note"},{default:o(()=>[n("span",{innerHTML:e.$locale.baseText("settings.log-streaming.infoText")},null,8,pe)]),_:1})]),e.storeHasItems()?(s(),l(v,{key:0},[(s(!0),l(v,null,Y(e.sortedItemKeysByLabel,d=>(s(),g(L,{key:d.key,gutter:10,class:c(e.$style.destinationItem)},{default:o(()=>{var E;return[(E=e.logStreamingStore.items[d.key])!=null&&E.destination?(s(),g(w,{key:0},{default:o(()=>{var C;return[r($,{destination:(C=e.logStreamingStore.items[d.key])==null?void 0:C.destination,"event-bus":e.eventBus,readonly:!e.canManageLogStreaming,onRemove:V=>{var p,f;return e.onRemove((f=(p=e.logStreamingStore.items[d.key])==null?void 0:p.destination)==null?void 0:f.id)},onEdit:V=>{var p,f;return e.onEdit((f=(p=e.logStreamingStore.items[d.key])==null?void 0:p.destination)==null?void 0:f.id)}},null,8,["destination","event-bus","readonly","onRemove","onEdit"])]}),_:2},1024)):_("",!0)]}),_:2},1032,["class"]))),128)),n("div",fe,[e.canManageLogStreaming?(s(),g(U,{key:0,size:"large",onClick:e.addDestination},{default:o(()=>[S(m(e.$locale.baseText("settings.log-streaming.add")),1)]),_:1},8,["onClick"])):_("",!0)])],64)):(s(),l("div",ve,[r(B,{"button-text":e.$locale.baseText("settings.log-streaming.add"),"onClick:button":e.addDestination},{heading:o(()=>[n("span",{innerHTML:e.$locale.baseText("settings.log-streaming.addFirstTitle")},null,8,Se)]),_:1},8,["button-text","onClick:button"])]))],64)):(s(),l(v,{key:1},[e.$locale.baseText("settings.log-streaming.infoText")?(s(),l("div",be,[r(b,{theme:"info",type:"note"},{default:o(()=>[n("span",{innerHTML:e.$locale.baseText("settings.log-streaming.infoText")},null,8,_e)]),_:1})])):_("",!0),n("div",ye,[r(B,{description:e.$locale.baseText("settings.log-streaming.actionBox.description"),"button-text":e.$locale.baseText("settings.log-streaming.actionBox.button"),"onClick:button":e.goToUpgrade},{heading:o(()=>[n("span",{innerHTML:e.$locale.baseText("settings.log-streaming.actionBox.title")},null,8,De)]),_:1},8,["description","button-text","onClick:button"])])],64))])}const ke={$style:me},Ze=I(le,[["render",Te],["__cssModules",ke]]);export{Ze as default};
//# sourceMappingURL=SettingsLogStreamingView-RNv0RtFP.js.map
