import{G as J,e as f,r as v,b as K,ag as d,l as T,m as V,T as u,O as c,S as x,R as o,u as s,p as a,M as k,I as p,Q as W,V as B,U as z}from"./vendor-NNwioulI.js";import{ax as Y,C as I,a as Z}from"./index-xP-VuMjv.js";import{m as tt,u as et,e as st,x as at,O as ot,_ as nt}from"./n8n-_nNvRoCf.js";import"./pinia-aUqqC48i.js";import"./@n8n/codemirror-lang-sql-feLn5IS9.js";import"./@lezer/common-1hBQ1gIF.js";import"./codemirror-lang-html-n8n-wWQLhhqk.js";import"./prettier-s3fE3Qyr.js";import"./@jsplumb/util-DR0SB56A.js";import"./@jsplumb/core-MKwKlGip.js";import"./@jsplumb/common-Q5_tv_GT.js";import"./@jsplumb/connector-bezier-3dWY17R5.js";import"./lodash-es-5z_C16pm.js";import"./@jsplumb/browser-ui-AlqFM-P6.js";import"./uuid-McvpxQtQ.js";import"./luxon-ZRIU05qF.js";import"./esprima-next-ulPLCZ1Z.js";import"./@vueuse/core-8g26_cc0.js";import"./codemirror-lang-n8n-expression-HpIZnV_9.js";import"./fast-json-stable-stringify-eHEaCv8s.js";import"./timeago.js--Bumj2r9.js";import"./qrcode.vue-UdCmS1Sj.js";import"./vue3-touch-events-_RfbPMOD.js";import"./chart.js-JtqvIvkt.js";import"./axios-s2RMMPhA.js";import"./flatted-jPn12Tq4.js";import"./vue-i18n-1PEMRmUU.js";import"./@n8n/permissions-8yMqUF1Y.js";const lt={class:"pb-3xl"},it={href:"https://docs.n8n.io/user-management/saml/",target:"_blank"},rt={key:0,"data-test-id":"sso-content-licensed"},ut={class:"mt-2xs mb-s"},dt=J({__name:"SettingsSso",setup(xt){const l={URL:"url",XML:"xml"},e=at(),M=ot(),R=tt(),n=Y(),$=et(),X=Z(),y=st(),N=f(()=>n.isSamlLoginEnabled?e.baseText("settings.sso.activated"):e.baseText("settings.sso.deactivated")),_=v(!1),S=v(),U=v(),O=v([{label:e.baseText("settings.sso.settings.ips.options.url"),value:l.URL},{label:e.baseText("settings.sso.settings.ips.options.xml"),value:l.XML}]),i=v(l.URL),m=v(),g=v(),D=f(()=>{var t,r;return i.value===l.URL?!!m.value&&m.value!==((t=n.samlConfig)==null?void 0:t.metadataUrl):i.value===l.XML?!!g.value&&g.value!==((r=n.samlConfig)==null?void 0:r.metadata):!1}),A=f(()=>i.value===l.URL?!!m.value&&_.value:i.value===l.XML?!!g.value&&_.value:!1),w=async()=>{const t=await n.getSamlConfig();U.value=t==null?void 0:t.entityID,S.value=t==null?void 0:t.returnUrl,t!=null&&t.metadataUrl?i.value=l.URL:t!=null&&t.metadata&&(i.value=l.XML),g.value=t==null?void 0:t.metadata,m.value=t==null?void 0:t.metadataUrl,_.value=!!(t!=null&&t.metadata)},G=async()=>{try{const t=i.value===l.URL?{metadataUrl:m.value}:{metadata:g.value};await n.saveSamlConfig(t),n.isSamlLoginEnabled||await X.confirm(e.baseText("settings.sso.settings.save.activate.message"),e.baseText("settings.sso.settings.save.activate.title"),{confirmButtonText:e.baseText("settings.sso.settings.save.activate.test"),cancelButtonText:e.baseText("settings.sso.settings.save.activate.cancel")})==="confirm"&&await h(),M.track("User updated single sign on settings",{instance_id:R.instanceId,identity_provider:i.value==="url"?"metadata":"xml",is_active:n.isSamlLoginEnabled})}catch(t){y.showError(t,e.baseText("settings.sso.settings.save.error"));return}finally{await w()}},h=async()=>{try{const t=await n.testSamlConfig();typeof window<"u"&&window.open(t,"_blank")}catch(t){y.showError(t,"error")}},P=()=>{$.goToUpgrade("sso","upgrade-sso")};return K(async()=>{if(n.isEnterpriseSamlEnabled)try{await w()}catch(t){y.showError(t,"error")}}),(t,r)=>{const L=d("n8n-heading"),Q=d("el-switch"),j=d("n8n-tooltip"),q=d("n8n-info-tip"),F=d("n8n-radio-buttons"),C=d("n8n-input"),E=d("n8n-button"),H=d("n8n-action-box");return T(),V("div",lt,[u(L,{size:"2xlarge"},{default:c(()=>[x(o(s(e).baseText("settings.sso.title")),1)]),_:1}),a("div",{class:p(t.$style.top)},[u(L,{size:"xlarge"},{default:c(()=>[x(o(s(e).baseText("settings.sso.subtitle")),1)]),_:1}),s(n).isEnterpriseSamlEnabled?(T(),k(j,{key:0,disabled:s(n).isSamlLoginEnabled||_.value},{content:c(()=>[a("span",null,o(s(e).baseText("settings.sso.activation.tooltip")),1)]),default:c(()=>[u(Q,{modelValue:s(n).isSamlLoginEnabled,"onUpdate:modelValue":r[0]||(r[0]=b=>s(n).isSamlLoginEnabled=b),disabled:!_.value,class:p(t.$style.switch),"inactive-text":N.value},null,8,["modelValue","disabled","class","inactive-text"])]),_:1},8,["disabled"])):W("",!0)],2),u(q,null,{default:c(()=>[x(o(s(e).baseText("settings.sso.info"))+" ",1),a("a",it,o(s(e).baseText("settings.sso.info.link")),1)]),_:1}),s(n).isEnterpriseSamlEnabled?(T(),V("div",rt,[a("div",{class:p(t.$style.group)},[a("label",null,o(s(e).baseText("settings.sso.settings.redirectUrl.label")),1),u(I,{value:S.value,"copy-button-text":s(e).baseText("generic.clickToCopy"),"toast-title":s(e).baseText("settings.sso.settings.redirectUrl.copied")},null,8,["value","copy-button-text","toast-title"]),a("small",null,o(s(e).baseText("settings.sso.settings.redirectUrl.help")),1)],2),a("div",{class:p(t.$style.group)},[a("label",null,o(s(e).baseText("settings.sso.settings.entityId.label")),1),u(I,{value:U.value,"copy-button-text":s(e).baseText("generic.clickToCopy"),"toast-title":s(e).baseText("settings.sso.settings.entityId.copied")},null,8,["value","copy-button-text","toast-title"]),a("small",null,o(s(e).baseText("settings.sso.settings.entityId.help")),1)],2),a("div",{class:p(t.$style.group)},[a("label",null,o(s(e).baseText("settings.sso.settings.ips.label")),1),a("div",ut,[u(F,{modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=b=>i.value=b),options:O.value},null,8,["modelValue","options"])]),B(a("div",null,[u(C,{modelValue:m.value,"onUpdate:modelValue":r[2]||(r[2]=b=>m.value=b),type:"text",name:"metadataUrl",size:"large",placeholder:s(e).baseText("settings.sso.settings.ips.url.placeholder")},null,8,["modelValue","placeholder"]),a("small",null,o(s(e).baseText("settings.sso.settings.ips.url.help")),1)],512),[[z,i.value===l.URL]]),B(a("div",null,[u(C,{modelValue:g.value,"onUpdate:modelValue":r[3]||(r[3]=b=>g.value=b),type:"textarea",name:"metadata",rows:4},null,8,["modelValue"]),a("small",null,o(s(e).baseText("settings.sso.settings.ips.xml.help")),1)],512),[[z,i.value===l.XML]])],2),a("div",{class:p(t.$style.buttons)},[u(E,{disabled:!D.value,size:"large","data-test-id":"sso-save",onClick:G},{default:c(()=>[x(o(s(e).baseText("settings.sso.settings.save")),1)]),_:1},8,["disabled"]),u(E,{disabled:!A.value,size:"large",type:"tertiary","data-test-id":"sso-test",onClick:h},{default:c(()=>[x(o(s(e).baseText("settings.sso.settings.test")),1)]),_:1},8,["disabled"])],2),a("footer",{class:p(t.$style.footer)},o(s(e).baseText("settings.sso.settings.footer.hint")),3)])):(T(),k(H,{key:1,"data-test-id":"sso-content-unlicensed",class:p(t.$style.actionBox),description:s(e).baseText("settings.sso.actionBox.description"),"button-text":s(e).baseText("settings.sso.actionBox.buttonText"),"onClick:button":P},{heading:c(()=>[a("span",null,o(s(e).baseText("settings.sso.actionBox.title")),1)]),_:1},8,["class","description","button-text"]))])}}}),ct="_top_1891z_5",pt="_buttons_1891z_18",mt="_group_1891z_27",gt="_actionBox_1891z_43",bt="_footer_1891z_47",vt={top:ct,switch:"_switch_1891z_12",buttons:pt,group:mt,actionBox:gt,footer:bt},_t={$style:vt},Ft=nt(dt,[["__cssModules",_t]]);export{Ft as default};
//# sourceMappingURL=SettingsSso-yOlGcdXl.js.map
